#If you have any problem or got bug contact me on discord 
# Discord id :- Desire#2365

exec('import re,base64,string')
exec(base64.b64decode("aW1wb3J0IGJzCmltcG9ydCBic0ludGVybmFsCmltcG9ydCBic1Bvd2VydXAKaW1wb3J0IGJzVXRpbHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgZ2V0UGVybWlzc2lvbnNIYXNoZXMgYXMgZ3BoCmltcG9ydCBqc29uCmltcG9ydCBjb2luU3lzdGVtCmZyb20gdGhyZWFkaW5nIGltcG9ydCBUaW1lcgppbXBvcnQgbG92ZQpmcm9tIHNldHRpbmdzIGltcG9ydCAqCmltcG9ydCBoYWNrCgpyZXBseSA9IE5vbmUKCmNsYXNzIEN1c3RvbShvYmplY3QpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpZCwgdGFnKToKICAgICAgICBzZWxmLmlkID0gaWQKICAgICAgICBzZWxmLnRhZyA9IHRhZwoKCmRlZiBtYWtlX2N1c3RvbShpZCwgdGFnKToKICAgIGN1c3RvbSA9IEN1c3RvbShpZCwgdGFnKQogICAgcmV0dXJuIGN1c3RvbQoKCmNsYXNzIGNoYXRPcHRpb25zKG9iamVjdCk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuYWxsID0gVHJ1ZQogICAgICAgIHNlbGYudGludCA9IE5vbmUKICAgICAgICByZXR1cm4KCiAgICBkZWYgY2hlY2tEZXZpY2Uoc2VsZiwgY2xpZW50SUQsIGNvbW1hbmQpOgogICAgICAgIGdsb2JhbCBjb21tYW5kQnlDb2luCiAgICAgICAgZ2xvYmFsIGNvbW1hbmRTdWNjZXNzCiAgICAgICAgZ2xvYmFsIGNvc3RPZkNvbW1hbmQKICAgICAgICBnbG9iYWwgcmVwbHkKICAgICAgICBnbG9iYWwgdXNlcgogICAgICAgIGNvbW1hbmRCeUNvaW4gPSBOb25lCiAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBOb25lCglyZXBseSA9IE5vbmUKICAgICAgICBjbGllbnRfc3RyID0gJycKICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbGllbnRJRDoKICAgICAgICAgICAgICAgIGNsaWVudF9zdHIgPSBpLmdldF9hY2NvdW50X2lkKCkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBjbGllbnRfc3RyIGluIGdwaC5vd25lckhhc2hlczoKICAgICAgICAgICAgCWJzLnNjcmVlbk1lc3NhZ2UoJ093bmVyIENvbW1hbmQgQWNjZXB0ZWQnLGNvbG9yPSgyLDEsNCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJI3JlcGx5ID0gJzopJwogICAgICAgICAgICAgICAgcmV0dXJuIDEwCiAgICAgICAgICAgIGVsaWYgY2xpZW50X3N0ciBpbiBncGguYWRtaW5IYXNoZXM6CiAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnQWRtaW4gQ29tbWFuZCBBY2NlcHRlZCcsY29sb3I9KDIsMSw0KSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCQkgICAgI3JlcGx5ID0gJzopJwogICAgICAgICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgIGVsaWYgY2xpZW50X3N0ciBpbiBncGgubWFuYWdlcjoKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdNYW5hZ2VyIENvbW1hbmQgQWNjZXB0ZWQnLGNvbG9yPSgyLDEsNCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJICAgICNyZXBseSA9ICc6KScKICAgICAgICAgICAgICAgICAgICByZXR1cm4gNSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgY2xpZW50X3N0ciBpbiBncGgudmlwSGFzaGVzOgogICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ01lbWJlciBDb21tYW5kIEFjY2VwdGVkJyxjb2xvcj0oMiwxLDQpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoJCSAgICAjcmVwbHkgPSAnOiknCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgZWxpZiBlbmFibGVDb2luU3lzdGVtIGFuZCBjb21tYW5kIGluIGF2YWlsYWJsZUNvbW1hbmRzOgogICAgICAgICAgICAgICAgICAgIGNvc3RPZkNvbW1hbmQgPSBhdmFpbGFibGVDb21tYW5kc1tjb21tYW5kXQogICAgICAgICAgICAgICAgICAgIGhhdmVDb2lucyA9IGNvaW5TeXN0ZW0uZ2V0Q29pbnMoY2xpZW50X3N0cikKICAgICAgICAgICAgICAgICAgICBpZiBoYXZlQ29pbnMgPj0gY29zdE9mQ29tbWFuZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZEJ5Q29pbiA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IGNsaWVudF9zdHIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDMKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnWW91IG5lZWQgJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihjb3N0T2ZDb21tYW5kKSArICcgZm9yIHRoYXQuIFlvdSBoYXZlICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoaGF2ZUNvaW5zKSArICcgb25seS4nKQogICAgICAgICAgICBlbGlmIGVuYWJsZVRvcDVjb21tYW5kcyBhbmQgY2xpZW50X3N0ciBpbiBncGgudG9wcGVyc2xpc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0NvbW1hbmQgQWNjZXB0ZWQnLGNvbG9yPSgyLDEsNCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJICAgICAgICAjcmVwbHkgPSAnOiknCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIHJldHVybiAwCgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICByZXR1cm4gMAoKICAgIGRlZiBraWNrQnlOaWNrKHNlbGYsIG5pY2spOgogICAgICAgIHJvc3RlciA9IGJzSW50ZXJuYWwuX2dldEdhbWVSb3N0ZXIoKQogICAgICAgIGZvciBpIGluIHJvc3RlcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgaVsncGxheWVycyddWzBdWyduYW1lRnVsbCddLmxvd2VyKCkuZmluZChuaWNrLmVuY29kZSgndXRmLTgnKS5sb3dlcigpKSAhPSAtMToKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9kaXNjb25uZWN0Q2xpZW50KGludChpWydjbGllbnRJRCddKSkgCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgb3B0KHNlbGYsIGNsaWVudElELCBtc2cpOgogICAgICAgIGdsb2JhbCBjb21tYW5kU3VjY2VzcwogICAgICAgIG0gPSBtc2cuc3BsaXQoJyAnKVswXQogICAgICAgIGEgPSBtc2cuc3BsaXQoJyAnKVsxOl0KICAgICAgICBhY3Rpdml0eSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKQogICAgICAgIHdpdGggYnMuQ29udGV4dChhY3Rpdml0eSk6CiAgICAgICAgICAgIHNlbmRlciA9IE5vbmUKICAgICAgICAgICAgZm9yIGkgaW4gYWN0aXZpdHkucGxheWVyczoKICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsaWVudElEOgogICAgICAgICAgICAgICAgICAgIHNlbmRlciA9IGkuZ2V0TmFtZSgpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKHNlbmRlciArICc6JyArIG1zZywgY29sb3I9KDAsIDAuNCwgMC44KSkKCQlwYXNzCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgIGxldmVsID0gc2VsZi5jaGVja0RldmljZShjbGllbnRJRCwgbSkKICAgICAgICAgICAgaWYgbSBpbiAoJy9zdGF0cycsICcvcmFuaycsICcvbXlzZWxmJywgJy9tZScpOgogICAgICAgICAgICAgICAgZm9yIHBsYXllciBpbiBhY3Rpdml0eS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgIGlmIHBsYXllci5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xpZW50SUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvcFN0YXRzLmpzb24nLCAncicpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHMgPSBqc29uLmxvYWRzKGYucmVhZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SUQgPSBwbGF5ZXIuZ2V0X2FjY291bnRfaWQoKQogICAgICAgICAgICAgICAgICAgICAgICAjaWYgZW5hYmxlQ29pblN5c3RlbTogaGF2ZUNvaW5zID0gY29pblN5c3RlbS5nZXRDb2lucyhhY2NvdW50SUQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFjY291bnRJRCBpbiBwYXRzOgoJCQkgICAgaWYgZW5hYmxlQ29pblN5c3RlbToKCQkJCWhhdmVDb2lucyA9IGNvaW5TeXN0ZW0uZ2V0Q29pbnMoYWNjb3VudElEKQoJCQkgICAgCXN0cmluZyA9ICd8fCAnICsgcGxheWVyLmdldE5hbWUoKSArICcgfCBXYWxsZXQ6JyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihoYXZlQ29pbnMpICsgJyB8IFJhbms6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydyYW5rJ10gKyAnIHwgR2FtZXM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydnYW1lcyddICsgJyB8IFNjb3JlOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsnc2NvcmVzJ10gKyAnIHwgS2lsbHM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydraWxscyddICsgJyB8IERlYXRoczonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ2RlYXRocyddICsgJyB8fCcKCQkJICAgIGVsc2U6CgkJCSAgICAJc3RyaW5nID0gJ3x8ICcgKyBwbGF5ZXIuZ2V0TmFtZSgpICsgICcgfCBSYW5rOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsncmFuayddICsgJyB8IEdhbWVzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsnZ2FtZXMnXSArICcgfCBTY29yZTonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ3Njb3JlcyddICsgJyB8IEtpbGxzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsna2lsbHMnXSArICcgfCBEZWF0aHM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydkZWF0aHMnXSArICcgfHwnCgkJCSAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZShzdHJpbmcpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI2JzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCd8fCAnICsgcGxheWVyLmdldE5hbWUoKSArICcgfCBXYWxsZXQ6JyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihoYXZlQ29pbnMpICsgJyB8IFJhbms6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydyYW5rJ10gKyAnIHwgR2FtZXM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydnYW1lcyddICsgJyB8IFNjb3JlOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsnc2NvcmVzJ10gKyAnIHwgS2lsbHM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydraWxscyddICsgJyB8IERlYXRoczonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ2RlYXRocyddICsgJyB8fCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVGhlIHBsYXllciAnICsgc3RyKHBsYXllci5nZXROYW1lKCkpICsgJyBpcyBub3QgeWV0IHJlZ2lzdGVyZWQnKQogICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxpZiBtID09ICcvcHNldHRpbmdzJyBhbmQgbGV2ZWwgPiA1OgoJCSAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiVXNhZ2UgL3BzZXR0aW5ncyAobnVtYmVyIGluIGxpc3QpICgwLDEpIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiTGlzdCBPZiBTZXR0aW5nczoiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIxLk5hbWUgT24gUG93ZXJVcHMiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIyLlBvd2VydXAgVGltZXIiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIzLlNoaWVsZCBPbiBQb3dlclVwcyIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjQuRGlzY28gTGlnaHRzIE9uIFBvd2VyVXBzIikKCQkgICAgICAgICAgICAgICAgICAgIHQgPSBpbnQoYVsxXSkKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjEiOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGxvdmUublAodCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjIiOgoJCSAgICAgICAgICAgICAgICAgICAgCWxvdmUucFQodCkKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjMiOgoJCSAgICAgICAgICAgICAgICAgICAgCWxvdmUuc1AodCkKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjQiOgoJCSAgICAgICAgICAgICAgICAgICAgCWxvdmUuZFAodCkKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL2F1dG9lZ2cnIGFuZCBsZXZlbCA+IDM6CgkJICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICB2YWwgPSAiMyIKCQkgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHN0cihhWzBdKQoJCSAgICAgICAgICAgICAgICBsb3ZlLmVnZyh2YWwpCgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKICAgICAgICAgICAgZWxpZiBtID09ICcvaGVscCc6CgkJICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJVc2FnZSAvaGVscCAocm9sZSkiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIgL2luZm8gL2VtIC9ydWxlcyAvc2hvcCAvc2NvcmV0b2Nhc2ggL2Nhc2h0b3Njb3JlIC9kb25hdGUiKQoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVswXSA9PSAib3duZXIiIGFuZCBsZXZlbCA+IDU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIiAgL3NldHRpbmdzIC9wc2V0dGluZ3MgL2JzZXR0aW5ncyAvYXV0b2FkbWluIC9hdXRvdmlwIC90ZWFtbmFtZSIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIiAgL3BhcnR5bmFtZSAvYmFuIC90ZXh0IC93aG9pcyAvYWRtaW4gL3ZpcCAvY3VzdG9tIC9jdXN0b210YWciKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIgIC9wdWJsaWMgL2NsZWFyIC9tYXhQbGF5ZXJzIC9lZ2cgL3J1aW5lIC9tYW5hZ2VyIC9vd25lciAiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVswXSA9PSAibWFuYWdlciIgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiICAvcHVibGljIC9jbGVhciAvbWF4UGxheWVycyAvdmlwIC9jdXN0b20gL2N1c3RvbXRhZyAvZWdnIC9ydWluZSAvYmFuIikKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gImFkbWluIiBhbmQgbGV2ZWwgPiAyOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIgIC9raWNrIC9xdWl0IC9ncCAvZ20gL2VuZCAvcGF1c2UiKQoJCSAgICAgICAgICAgICAgICAgICAgCWNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVswXSA9PSAidmlwIiBhbmQgbGV2ZWwgPiAxOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIgIC9raWxsYWxsIC9lbmQgL252IC90aW50IC9yZWZsZWN0aW9uIC9mcmVlemUgYWxsIC90aGF3YWxsIC9pbnZhbGwgL3NtZyIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIiAgL3R0bWcgL3RtZyAvYWMgL3BsYXlzb3VuZCAvYm94YWxsIC96b21iaWUgL3NwYXogL2J1bm55IC90ZXgiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIgIC9zbGVlcCAvY3Vyc2UgL3NtIC9odWcgL2NhbWVyYU1vZGUgL2ljeSAvZmx5IC9mbG9vclJlZmxlY3Rpb24gL2ljZU9mZiIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIiAgL2hlYWwgL3NoYXR0ZXIgL2NtIC9pZCAvZWdnYyIpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgogICAgICAgICAgICBlbGlmIChtID09ICcvZW1vdGUnKSBvciAobSA9PSAnL2VtJyk6CiAgICAgICAgICAgICAgICBpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoIkF2YWlsYWJsZSBFbW90ZXMgZmlyZSwgYW5ncnksIGxvbCwgZGVhZCwgaHVoLCB3aGF0LCBwb3dlciIsY29sb3I9KDEsMSwxKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gJ2ZpcmUnOgogICAgICAgICAgICAgICAgICAgIHB0eHQgPSB1J1xVMDAwMUY1MjUnCiAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2FuZ3J5JzoKICAgICAgICAgICAgICAgICAgICBwdHh0ID0gdSdcVTAwMDFGNEEyJwogICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICdsb2wnOgogICAgICAgICAgICAgICAgICAgIHB0eHQgPSB1J1xVMDAwMUY2MDInCiAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2RlYWQnOgogICAgICAgICAgICAgICAgICAgIHB0eHQgPSB1J1xVMDAwMUY0ODAnCiAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2h1aCc6CiAgICAgICAgICAgICAgICAgICAgcHR4dCA9IHUnXFUwMDAxRjYwRicKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnd2hhdCc6CiAgICAgICAgICAgICAgICAgICAgcHR4dCA9IHUnXFUwMDAxRjYxMScKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAncG93ZXInOgogICAgICAgICAgICAgICAgICAgIHB0eHQgPSB1J1xVMDAwMUY0QUEnCiAgICAgICAgICAgICAgICBkZWYgQ2lkVG9BY3RvcihjaWQpOgogICAgICAgICAgICAgICAgICAgIGZvciBzIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0U2Vzc2lvbigpLnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjaWQgPSBpbnQocy5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBjaWQgPT0gaW50KGNpZCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5hY3RvcgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICBic1V0aWxzLlBvcHVwVGV4dChwdHh0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPTIuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uPUNpZFRvQWN0b3IoY2xpZW50SUQpLm5vZGUucG9zaXRpb24pLmF1dG9SZXRhaW4oKQogICAgICAgICAgICBlbGlmIG0gPT0gJy90ZWFtTmFtZScgYW5kIGxldmVsID4gNToKICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgiVHJ5IC90ZWFtTmFtZSBSZWQgQmx1ZSIsY29sb3I9KDEsMSwxKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSh1IkZldyBFbW90ZXMgXFUwMDAxRjQ4MCxcdWUwMGMsXHVlMDQ4LFx1ZTA0NixcdWUwNDMiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb3ZlLnROKGFbMF0sYVsxXSkKICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgZWxpZiBtID09ICdlZ2cnOgogICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSh1IlxVMDAwMUY5NUEiKSAgICAgICAgICAgIAkKICAgICAgICAgICAgZWxpZiBtID09ICcvYnNldHRpbmdzJyBhbmQgbGV2ZWwgPiA1OgoJCSAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiVXNhZ2UgL2JzZXR0aW5ncyAobnVtYmVyIGluIGxpc3QpICgwLDEpIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiTGlzdCBPZiBTZXR0aW5nczoiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIxLk5hbWUgT24gQm9tYiIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjIuQm9tYkxpZ2h0cyIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjMuU2hpZWxkIG9uIEJvbWIiKQoJCSAgICAgICAgICAgICAgICAgICAgdCA9IGludChhWzFdKQoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVswXSA9PSAiMSI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgbG92ZS5iTih0KQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVswXSA9PSAiMiI6CgkJICAgICAgICAgICAgICAgICAgICAJbG92ZS5iTCh0KQoJCSAgICAgICAgICAgICAgICAgICAgCWNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVswXSA9PSAiMyI6CgkJICAgICAgICAgICAgICAgICAgICAJbG92ZS5zQih0KQoJCSAgICAgICAgICAgICAgICAgICAgCWNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKICAgICAgICAgICAgZWxpZiBtID09ICcvc21nJzoKICAgICAgICAgICAgICAgIHB0eHQgPSBzdHIoYVswXSkKICAgICAgICAgICAgICAgIGRlZiBDaWRUb0FjdG9yKGNpZCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIHMgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNpZCA9IGludChzLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGNpZCA9PSBpbnQoY2lkKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzLmFjdG9yCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIGJzVXRpbHMuUG9wdXBUZXh0KHB0eHQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9Mi4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb249Q2lkVG9BY3RvcihjbGllbnRJRCkubm9kZS5wb3NpdGlvbikuYXV0b1JldGFpbigpCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL2RvbmF0ZScgYW5kIGVuYWJsZUNvaW5TeXN0ZW06CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGEpIDwgMjoKICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnVXNhZ2U6IC9kb25hdGUgYW1vdW50IGNsaWVudElEJywgdHJhbnNpZW50PVRydWUsIGNsaWVudHM9W2NsaWVudElEXSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2ZlciA9IGludChhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmFuc2ZlciA8IDEwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdZb3UgY2FuIG9ubHkgdHJhbnNmZXIgbW9yZSB0aGFuICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyAnMTAwLicpCgkJCSAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyc0lEID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlcnNJRCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHBsYXllciBpbiBhY3Rpdml0eS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xJRCA9IHBsYXllci5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFpZCA9IHBsYXllci5nZXRfYWNjb3VudF9pZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjbElEID09IGNsaWVudElEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcnNJRCA9IGFpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2xJRCA9PSBpbnQoYVsxXSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJzSUQgPSBhaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gcGxheWVyLmdldE5hbWUoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBOb25lIG5vdCBpbiBbc2VuZGVyc0lELCByZWNlaXZlcnNJRF06CgkJCSAgICBpZiBzZW5kZXJzSUQgPT0gcmVjZWl2ZXJzSUQ6CgkJCQlicy5zY3JlZW5NZXNzYWdlKCdZb3UgY2FuXCd0IHRyYW5zZmVyIHRvIHlvdXIgb3duIGFjY291bnQnLCBjb2xvcj0oMSwgMCwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNvaW5TeXN0ZW0uZ2V0Q29pbnMoc2VuZGVyc0lEKSA8IHRyYW5zZmVyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdOb3QgZW5vdWdoICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyAnIHRvIHBlcmZvcm0gdHJhbnNhY3Rpb24nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2luU3lzdGVtLmFkZENvaW5zKHNlbmRlcnNJRCwgaW50KHRyYW5zZmVyICogLTEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvaW5TeXN0ZW0uYWRkQ29pbnMocmVjZWl2ZXJzSUQsIGludCh0cmFuc2ZlcikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1N1Y2Nlc3NmdWxseSB0cmFuc2ZlcmVkICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBhWzBdICsgJyBpbnRvICcgKyBuYW1lICsgIidzIGFjY291bnQuIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ1BsYXllciBub3QgRm91bmQnLCBjb2xvcj0oMSwgMCwgMCkpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnVXNhZ2U6IC9kb25hdGUgYW1vdW50IGNsaWVudElEJywgdHJhbnNpZW50PVRydWUsIGNsaWVudHM9W2NsaWVudElEXSkKCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL2J1eScgYW5kIGVuYWJsZUNvaW5TeXN0ZW06CiAgICAgICAgICAgICAgICBpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FhZ2U6IC9idXkgaXRlbV9uYW1lJykKICAgICAgICAgICAgICAgIGVsaWYgYVswXSBpbiBhdmFpbGFibGVFZmZlY3RzOgogICAgICAgICAgICAgICAgICAgIGVmZmVjdCA9IGFbMF0KICAgICAgICAgICAgICAgICAgICBjbGllbnRfc3RyID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbGllbnRJRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9zdHIgPSBpLmdldF9hY2NvdW50X2lkKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgY2xpZW50X3N0ciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY29zdE9mRWZmZWN0ID0gYXZhaWxhYmxlRWZmZWN0c1tlZmZlY3RdCiAgICAgICAgICAgICAgICAgICAgICAgIGhhdmVDb2lucyA9IGNvaW5TeXN0ZW0uZ2V0Q29pbnMoY2xpZW50X3N0cikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGF2ZUNvaW5zID49IGNvc3RPZkVmZmVjdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbWVycyA9IGdwaC5lZmZlY3RDdXN0b21lcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNsaWVudF9zdHIgbm90IGluIGN1c3RvbWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgdGltZWRlbHRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJ5ID0gZGF0ZXRpbWUubm93KCkgKyB0aW1lZGVsdGEoZGF5cz0xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbWVyc1tjbGllbnRfc3RyXSA9IHsnZWZmZWN0JzogZWZmZWN0LCAnZXhwaXJ5JzogZXhwaXJ5LnN0cmZ0aW1lKCclZC0lbS0lWSAlSDolTTolUycpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL2dldFBlcm1pc3Npb25zSGFzaGVzLnB5JykgYXMgKGZpbGUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1s0XSA9ICdlZmZlY3RDdXN0b21lcnMgPSAnICsgc3RyKGN1c3RvbWVycykgKyAnXG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknLCAndycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2luU3lzdGVtLmFkZENvaW5zKGNsaWVudF9zdHIsIGNvc3RPZkVmZmVjdCAqIC0xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdTdWNjZXNzISBUaGF0IGNvc3QgeW91ICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoY29zdE9mRWZmZWN0KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRWZmZWN0ID0gY3VzdG9tZXJzW2NsaWVudF9zdHJdWydlZmZlY3QnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ1lvdSBhbHJlYWR5IGhhdmUgJyArIGFjdGl2ZUVmZmVjdCArICcgZWZmZWN0IGFjdGl2ZScsY29sb3I9KDEsMSwxKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdZb3UgbmVlZCAnICsgYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgc3RyKGNvc3RPZkVmZmVjdCkgKyAnIGZvciB0aGF0LiBZb3UgaGF2ZSAnICsgYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgc3RyKGhhdmVDb2lucykgKyAnIG9ubHkuJykKCgogICAgICAgICAgICBlbGlmIG0gPT0gJy9saXN0JzoKICAgICAgICAgICAgICAgICNzdHJpbmcgPSB1Jz09TmFtZT09PT09PT09Q2xpZW50SUQ9PT09UGxheWVySUQ9PVxuJwoJCXN0cmluZyA9IHUnezA6XjE2fXsxOl4xNX17MjpeMTB9XG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbicuZm9ybWF0KCdOYW1lJywnQ2xpZW50SUQnLCdQbGF5ZXJJRCcpCiAgICAgICAgICAgICAgICBmb3IgcyBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICNzdHJpbmcgKz0gcy5nZXROYW1lKCkgICc9PT09PT09PScgKyBzdHIocy5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkpICsgJz09PT0nICsgc3RyKGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0U2Vzc2lvbigpLnBsYXllcnMuaW5kZXgocykpICsgJ1xuJwoJCSAgICBzdHJpbmcgKz0gdSd7MDpeMTZ9ezE6XjE1fXsyOl4xMH1cbicuZm9ybWF0KHMuZ2V0TmFtZShUcnVlLFRydWUpLCBzdHIocy5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkpLCBzdHIoYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkucGxheWVycy5pbmRleChzKSkpCiAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKHN0cmluZywgdHJhbnNpZW50PVRydWUsIGNvbG9yPSgxLCAxLCAxKSwgY2xpZW50cz1bY2xpZW50SURdKQoJCSNwcmludCBzdHJpbmcKCQkKCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL3Nob3AnIGFuZCBlbmFibGVDb2luU3lzdGVtOgogICAgICAgICAgICAgICAgc3RyaW5nID0gJz09WW91IGNhbiBidXkgZm9sbG93aW5nIGl0ZW1zPT1cbicKICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnVXNhZ2U6IC9zaG9wIGNvbW1hbmRzIG9yIC9zaG9wIGVmZmVjdHMnLCB0cmFuc2llbnQ9VHJ1ZSwgY29sb3I9KDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjEpLCBjbGllbnRzPVtjbGllbnRJRF0pCiAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2VmZmVjdHMnOgogICAgICAgICAgICAgICAgICAgIGZvciB4IGluIGF2YWlsYWJsZUVmZmVjdHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyArPSB4ICsgJy0tLS0nICsgYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgc3RyKGF2YWlsYWJsZUVmZmVjdHNbeF0pICsgJy0tLS1mb3IgMSBkYXlcbicKCiAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZShzdHJpbmcsIHRyYW5zaWVudD1UcnVlLCBjb2xvcj0oMCwgMSwgMCksIGNsaWVudHM9W2NsaWVudElEXSkKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnY29tbWFuZHMnOgoJCSAgICBzZXBhcmF0b3IgPSAnICAgICAgICAgICcKICAgICAgICAgICAgICAgICAgICBmb3IgeCBpbiBhdmFpbGFibGVDb21tYW5kczoKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IHggKyAnLS0tLScgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoYXZhaWxhYmxlQ29tbWFuZHNbeF0pICsgc2VwYXJhdG9yCgkJCWlmIHNlcGFyYXRvciA9PSAnICAgICAgICAgICc6CgkJCQlzZXBhcmF0b3IgPSAnXG4nCgkJCWVsc2U6CgkJCQlzZXBhcmF0b3IgPSAnICAgICAgICAgICcKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKHN0cmluZywgdHJhbnNpZW50PVRydWUsIGNvbG9yPSgwLCAxLCAwKSwgY2xpZW50cz1bY2xpZW50SURdKQoKICAgICAgICAgICAgZWxpZiBtID09ICcvY2FzaHRvc2NvcmUnIGFuZCBlbmFibGVDb2luU3lzdGVtOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNvaW5zID0gaW50KGFbMF0pCiAgICAgICAgICAgICAgICAgICAgZm9yIHBsYXllciBpbiBhY3Rpdml0eS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsaWVudElEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElEID0gcGxheWVyLmdldF9hY2NvdW50X2lkKCkKCQkJICAgIGhhdmVDb2lucyA9IGNvaW5TeXN0ZW0uZ2V0Q29pbnMoYWNjb3VudElEKQoJCQkgICAgaWYgaGF2ZUNvaW5zIDwgY29pbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ05vdCBlbm91Z2ggJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArICcgdG8gcGVyZm9ybSB0aGUgdHJhbnNhY3Rpb24nKQoJCQkgICAgZWxpZiBjb2lucyA8IDEwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnWW91IGNhbiBvbmx5IGNvbnZlcnQgbW9yZSB0aGFuICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyAnMTAwJykKCQkJICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29pblN5c3RlbS5hZGRDb2lucyhhY2NvdW50SUQsIGNvaW5zICogLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9zdGF0cy5qc29uJywgJ3InKQoJCQkJc3RhdHMgPSBqc29uLmxvYWRzKGYucmVhZCgpKQoJCQkJZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXZhbGVudFNjb3JlID0gaW50KGNvaW5zICogNSAqIDAuOSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1thY2NvdW50SURdWydzY29yZXMnXSArPSBlcXVpdmFsZW50U2NvcmUKCQkJCWYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvc3RhdHMuanNvbicsICd3JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGpzb24uZHVtcHMoc3RhdHMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ1RyYW5zYWN0aW9uIFN1Y2Nlc3NmdWwnLCBjb2xvcj0oMCwxLDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHN0cihlcXVpdmFsZW50U2NvcmUpICsgJ3Njb3JlIGFkZGVkIHRvIHlvdXIgYWNjb3VudCBzdGF0cy4gWzEwJSB0cmFuc2FjdGlvbiBmZWUgZGVkdWN0ZWRdJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgbXlzdGF0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15c3RhdHMucmVmcmVzaFN0YXRzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgkJCQkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdVc2FnZTogL2Nhc2h0b3Njb3JlIGFtb3VudF9vZl9jYXNoJywgdHJhbnNpZW50PVRydWUsIGNvbG9yPSgxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4xKSwgY2xpZW50cz1bY2xpZW50SURdKQoKCgogICAgICAgICAgICBlbGlmIG0gPT0gJy9zY29yZXRvY2FzaCcgYW5kIGVuYWJsZUNvaW5TeXN0ZW06CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2NvcmUgPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICBmb3IgcGxheWVyIGluIGFjdGl2aXR5LnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBsYXllci5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xpZW50SUQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL3N0YXRzLmpzb24nLCAncicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0cyA9IGpzb24ubG9hZHMoZi5yZWFkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SUQgPSBwbGF5ZXIuZ2V0X2FjY291bnRfaWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGF2ZVNjb3JlID0gc3RhdHNbYWNjb3VudElEXVsnc2NvcmVzJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGF2ZVNjb3JlIDwgc2NvcmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ05vdCBlbm91Z2ggc2NvcmVzIHRvIHBlcmZvcm0gdGhlIHRyYW5zYWN0aW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgc2NvcmUgPCA1MDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1lvdSBjYW4gb25seSBjb252ZXJ0IG1vcmUgdGhhbiA1MDBzY29yZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL3N0YXRzLmpzb24nLCAndycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNbYWNjb3VudElEXVsnc2NvcmVzJ10gLT0gc2NvcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGpzb24uZHVtcHMoc3RhdHMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxdWl2YWxlbnRDb2lucyA9IGludChzY29yZSAvIDUgKiAwLjkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29pblN5c3RlbS5hZGRDb2lucyhhY2NvdW50SUQsIGVxdWl2YWxlbnRDb2lucykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdUcmFuc2FjdGlvbiBTdWNjZXNzZnVsJywgY29sb3I9KDAsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihlcXVpdmFsZW50Q29pbnMpICsgJyBhZGRlZCB0byB5b3VyIGFjY291bnQuIFsxMCUgdHJhbnNhY3Rpb24gZmVlIGRlZHVjdGVkXScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IG15c3RhdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteXN0YXRzLnJlZnJlc2hTdGF0cygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdVc2FnZTogL3Njb3JldG9jYXNoIGFtb3VudF9vZl9zY29yZScsIHRyYW5zaWVudD1UcnVlLCBjb2xvcj0oMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMSksIGNsaWVudHM9W2NsaWVudElEXSkKCiAgICAgICAgICAgIGVsaWYgbGV2ZWwgPiAwOgogICAgICAgICAgICAgICAgaWYgbSA9PSAnL252JzoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnRpbnQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW50ID0gYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykudGludAogICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLnRpbnQgPSAoMC41LCAwLjcsIDEpIGlmIGEgPT0gW10gb3Igbm90IGFbMF0gPT0gJ29mZicgZWxzZSBzZWxmLnRpbnQKICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL29vaCc6CiAgICAgICAgICAgICAgICAgICAgaWYgYSBpcyBub3QgTm9uZSBhbmQgbGVuKGEpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGludChhWzBdKQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVmIG9vaFJlY3VyY2UoYyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5wbGF5U291bmQoYnMuZ2V0U291bmQoJ29vaCcpLCB2b2x1bWUgPTIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjIC09IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGMgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdhbWVUaW1lcihpbnQoYVsxXSkgaWYgbGVuKGEpID4gMSBhbmQgYVsxXSBpcyBub3QgTm9uZSBlbHNlIDEwMDAsIGJzLkNhbGwob29oUmVjdXJjZSwgYz1jKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgICAgICAgICAgICAgb29oUmVjdXJjZShjPXMpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKCdvb2gnKSwgdm9sdW1lID0yKQogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgZWxpZiBtID09ICcvcGxheVNvdW5kJzoKICAgICAgICAgICAgICAgICAgICBpZiBhIGlzIG5vdCBOb25lIGFuZCBsZW4oYSkgPiAxOgogICAgICAgICAgICAgICAgICAgICAgICBzID0gaW50KGFbMV0pCgogICAgICAgICAgICAgICAgICAgICAgICBkZWYgb29oUmVjdXJjZShjKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnBsYXlTb3VuZChicy5nZXRTb3VuZChzdHIoYVswXSkpLCB2b2x1bWUgPTIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjIC09IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGMgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdhbWVUaW1lcihpbnQoYVsyXSkgaWYgbGVuKGEpID4gMiBhbmQgYVsyXSBpcyBub3QgTm9uZSBlbHNlIDEwMDAsIGJzLkNhbGwob29oUmVjdXJjZSwgYz1jKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgICAgICAgICAgICAgb29oUmVjdXJjZShjPXMpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKHN0cihhWzBdKSksIHZvbHVtZSA9MikKICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9ib3gnLCAnL2JveGFsbCcpOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbSA9PSAnL2JveGFsbCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ3RudCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5jb2xvck1hc2tUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgndG50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ3RudCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oaWdobGlnaHQgPSAoMSwgMSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yID0gKDEsIDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oZWFkTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5zdHlsZSA9ICdjeWJvcmcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZXJyb3InCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FnZTogL2JveGFsbCBvciAvYm94IHBsYXllcl9jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gaW50KGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ3RudCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvck1hc2tUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgndG50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ3RudCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5oaWdobGlnaHQgPSAoMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvciA9ICgxLCAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmhlYWRNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLnN0eWxlID0gJ2N5Ym9yZycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNhZ2U6IC9ib3hhbGwgb3IgL2JveCBwbGF5ZXJfY29kZScpCgogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL2VnZ2MnLCAnL2VnZ2NhbGwnKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG0gPT0gJy9lZ2djYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnRvcnNvTW9kZWwgPSBicy5nZXRNb2RlbCgnZWdnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKCdlZ2cxJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2VnZzEnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuaGlnaGxpZ2h0ID0gKDEsIDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5jb2xvciA9ICgxLCAxLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuc3R5bGUgPSAnY3lib3JnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Vycm9yJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNhZ2U6IC9lZ2djIG9yIC9lZ2djYWxsIHBsYXllcl9jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gaW50KGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ2VnZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvck1hc2tUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgnZWdnMScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvclRleHR1cmUgPSBicy5nZXRUZXh0dXJlKCdlZ2cxJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmhpZ2hsaWdodCA9ICgxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yID0gKDEsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuc3R5bGUgPSAnY3lib3JnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FnZTogL2VnZ2NhbGwgb3IgL2VnZ2MgcGxheWVyX2NvZGUnKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCiAgICAgICAgICAgICAgICBlbGlmIG0gaW4gKCcvc3BheicsICcvc3BhemFsbCcpOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3NwYXphbGwgb3IgL3NwYXogbnVtYmVyIG9mIGxpc3QnKQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9zcGF6YWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYXBwZW5kKGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IGkuYWN0b3Iubm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkJICAJICBpZiBhWzFdIGluIFsnYWxpJywnbmVvU3BheicsJ3dpemFyZCcsJ2N5Ym9yZycsJ3Blbmd1aW4nLCdhZ2VudCcsJ3BpeGllJywnYmVhcicsJ2J1bm55Jywna3JvbmsnLCdzYW50YScsJ2JvbmVzJywnZnJvc3R5JywncGlyYXRlJywnbWVsJywnbmluamEnLCdmZW1hbGUnLCd6b21iaWUnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5jb2xvclRleHR1cmUgPSBicy5nZXRUZXh0dXJlKGFbMV0gKyAnQ29sb3InKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKGFbMV0gKyAnQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oZWFkTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ0hlYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRvcnNvTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ1RvcnNvJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wZWx2aXNNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnUGVsdmlzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC51cHBlckFybU1vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdVcHBlckFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuZm9yZUFybU1vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdGb3JlQXJtJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ0hhbmQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyTGVnTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ1VwcGVyTGVnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5sb3dlckxlZ01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdMb3dlckxlZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdUb2VzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zdHlsZSA9IGFbMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdlcnJvcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJCSAgICAgIGlmIGFbMV0gaW4gWydhbGknLCduZW9TcGF6Jywnd2l6YXJkJywnY3lib3JnJywncGVuZ3VpbicsJ2FnZW50JywncGl4aWUnLCdiZWFyJywnYnVubnknLCdrcm9uaycsJ3NhbnRhJywnYm9uZXMnLCdmcm9zdHknLCdwaXJhdGUnLCdtZWwnLCduaW5qYScsJ2ZlbWFsZScsJ3pvbWJpZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuY29sb3JUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZShhWzFdICsgJ0NvbG9yJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKGFbMV0gKyAnQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhlYWRNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnSGVhZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdUb3JzbycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wZWx2aXNNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnUGVsdmlzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyQXJtTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ1VwcGVyQXJtJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmZvcmVBcm1Nb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnRm9yZUFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ0hhbmQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudXBwZXJMZWdNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnVXBwZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQubG93ZXJMZWdNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnTG93ZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdUb2VzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN0eWxlID0gYVsxXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3NwYXphbGwgb3IgL3NwYXogbnVtYmVyIG9mIGxpc3QnKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ2Vycm9yJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL3pvbWJpZScsICcvem9tYmllYWxsJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIAlicy5zY3JlZW5NZXNzYWdlKCdNYWRlIEJ5IERlc2llcicsY29sb3I9KDEsMC4xOCwwLjQyKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbSA9PSAnL3pvbWJpZWFsbCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9yc28nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuY29sb3JNYXNrVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ3BpeGllQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2FnZW50Q29sb3InKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gYnMuZ2V0TW9kZWwoJ3pvZUhlYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUucGVsdmlzTW9kZWwgPSBicy5nZXRNb2RlbCgncGl4aWVQZWx2aXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUudXBwZXJBcm1Nb2RlbCA9IGJzLmdldE1vZGVsKCdmcm9zdHlVcHBlckFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5mb3JlQXJtTW9kZWwgPSBicy5nZXRNb2RlbCgnZnJvc3R5Rm9yZUFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNIYW5kJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnVwcGVyTGVnTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNVcHBlckxlZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5sb3dlckxlZ01vZGVsID0gYnMuZ2V0TW9kZWwoJ3BpeGllTG93ZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9lcycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oaWdobGlnaHQgPSAoMCwxLDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5jb2xvciA9ICgwLjYsMC42LDAuNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnN0eWxlID0gJ3NwYXonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZXJyb3InCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FnZTogL3pvbWJpZWFsbCBvciAvem9tYmllIHBsYXllcl9jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gaW50KGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9yc28nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuY29sb3JNYXNrVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ3BpeGllQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2FnZW50Q29sb3InKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gYnMuZ2V0TW9kZWwoJ3pvZUhlYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUucGVsdmlzTW9kZWwgPSBicy5nZXRNb2RlbCgncGl4aWVQZWx2aXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUudXBwZXJBcm1Nb2RlbCA9IGJzLmdldE1vZGVsKCdmcm9zdHlVcHBlckFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5mb3JlQXJtTW9kZWwgPSBicy5nZXRNb2RlbCgnZnJvc3R5Rm9yZUFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNIYW5kJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLnVwcGVyTGVnTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNVcHBlckxlZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5sb3dlckxlZ01vZGVsID0gYnMuZ2V0TW9kZWwoJ3BpeGllTG93ZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9lcycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5oaWdobGlnaHQgPSAoMCwxLDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvciA9ICgwLjYsMC42LDAuNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLnN0eWxlID0gJ3NwYXonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWdlOiAvem9tYmllYWxsIG9yIC96b21iaWUgcGxheWVyX2NvZGUnKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL2ludicsICcvaW52YWxsJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvaW52YWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBpLmFjdG9yLm5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhlYWRNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRvcnNvTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wZWx2aXNNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyQXJtTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5mb3JlQXJtTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oYW5kTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC51cHBlckxlZ01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQubG93ZXJMZWdNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRvZXNNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN0eWxlID0gJ2N5Ym9yZycKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvaW52YWxsIG9yIC9pbnYgbnVtYmVyIG9mIGxpc3QnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuaGVhZE1vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9yc29Nb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnBlbHZpc01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudXBwZXJBcm1Nb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmZvcmVBcm1Nb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhhbmRNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyTGVnTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5sb3dlckxlZ01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9lc01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3R5bGUgPSAnY3lib3JnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2ludmFsbCBvciAvaW52IG51bWJlciBvZiBsaXN0JykKCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgogICAgICAgICAgICAgICAgZWxpZiBtID09ICcvYnVubnlOT3RhdmFpbGFiZWhlcmUnOgogICAgICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2J1bm55IGNvdW50IG93bmVyKG51bWJlciBvZiBsaXN0KScpCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0IEJ1ZGR5QnVubnkKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShpbnQoYVswXSkpOgogICAgICAgICAgICAgICAgICAgICAgICBwID0gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbaW50KGFbMV0pXQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYnVubmllcycgbm90IGluIHAuZ2FtZURhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmdhbWVEYXRhWydidW5uaWVzJ10gPSBCdWRkeUJ1bm55LkJ1bm55Qm90U2V0KHApCiAgICAgICAgICAgICAgICAgICAgICAgIHAuZ2FtZURhdGFbJ2J1bm5pZXMnXS5kb0J1bm55KCkKCiAgICAgICAgICAgICAgICBlbGlmIG0gaW4gKCcvdGV4JywgJy90ZXhhbGwnKToKICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvdGV4YWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKCdlZ2cxJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuY29sb3JUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgnZWdnMScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Vycm9yJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCiAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC90ZXhhbGwgb3IgL3RleCBudW1iZXIgb2YgbGlzdCcpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGludChhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvck1hc2tUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgnZWdnMScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2VnZzEnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCgoJCWVsaWYgbGV2ZWw+MToKICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvdHRtZyc6IAogICAgICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdUaGFua3MgVG8gUGMgTW9kZGVyJyxjb2xvcj0oMSwxLDEpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTogICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYnMuc2NyZWVuTWVzc2FnZSgoYVswXSksY29sb3IgPSAoMSwxLDEpKSAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNVdGlscy5ab29tVGV4dCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYVswXSksIG1heFdpZHRoPTgwMCwgbGlmZXNwYW49MjUwMCwgaml0dGVyPTIuMCwgcG9zaXRpb249KDAsIDE4MCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhc2g9RmFsc2UsIGNvbG9yPSgoMCtyYW5kb20ucmFuZG9tKCkqMC41KSwoMCtyYW5kb20ucmFuZG9tKCkqMC41KSwoMCtyYW5kb20ucmFuZG9tKCkqMC41KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWxDb2xvcj0oKDArcmFuZG9tLnJhbmRvbSgpKjQuNSksKDArcmFuZG9tLnJhbmRvbSgpKjQuNSksKDArcmFuZG9tLnJhbmRvbSgpKjQuNSkpKS5hdXRvUmV0YWluKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgICAgIGlmIG0gPT0gJy90bWcnOiAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXTogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnVGhhbmtzIFRvIFBjIE1vZGRlcicsY29sb3I9KDEsMSwxKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTogICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYnMuc2NyZWVuTWVzc2FnZSgoYVswXSksY29sb3IgPSAoMSwxLDEpKSAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IChhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuWm9vbVRleHQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaywgbWF4V2lkdGg9ODAwLCBsaWZlc3Bhbj0yNTAwLCBqaXR0ZXI9Mi4wLCBwb3NpdGlvbj0oMCwgMTgwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFzaD1GYWxzZSwgY29sb3I9KDAuOTMgKiAxLjI1LCAwLjkgKiAxLjI1LCAxLjAgKiAxLjI1KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbENvbG9yPSgwLjE1LCAwLjA1LCAxLjAsIDAuMCkpLmF1dG9SZXRhaW4oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCQkJCiAgICAgICAgICAgICAgICAgICAgaWYgbSBpbiAoJy9mcmVlemUnLCAnL2ZyZWV6ZWFsbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvZnJlZXplYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhhbmRsZU1lc3NhZ2UoYnMuRnJlZXplTWVzc2FnZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2ZyZWV6ZWFsbCBvciAvZnJlZXplIG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZShicy5GcmVlemVNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvZnJlZXplYWxsIG9yIC9mcmVlemUgbnVtYmVyIG9mIGxpc3QnKQoKICAgICAgICAgICAgICAgICAgICBlbGlmIG0gaW4gKCcvdGhhdycsICcvdGhhd2FsbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvdGhhd2FsbCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oYW5kbGVNZXNzYWdlKGJzLlRoYXdNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3RoYXdhbGwgb3IgbnVtYmVyIG9mIGxpc3QnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5oYW5kbGVNZXNzYWdlKGJzLlRoYXdNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvdGhhd2FsbCBvciAvdGhhdyBudW1iZXIgb2YgbGlzdCcpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9zbGVlcCcsICcvc2xlZXBhbGwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbSA9PSAnL3NsZWVwYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhhbmRsZU1lc3NhZ2UoJ2tub2Nrb3V0JywgNTAwMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvc2xlZXBhbGwgb3IgL3NsZWVwIG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZSgna25vY2tvdXQnLCA1MDAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3NsZWVwYWxsIG9yIC9zbGVlcCBudW1iZXIgb2YgbGlzdCcpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9raWxsJywgJy9raWxsYWxsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG0gPT0gJy9raWxsYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhhbmRsZU1lc3NhZ2UoYnMuRGllTWVzc2FnZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC9raWxsYWxsIG9yIC9raWxsIG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZShicy5EaWVNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAva2lsbGFsbCBvciAva2lsbCBudW1iZXIgb2YgbGlzdCcpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL2N1cnNlJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2N1cnNlIGFsbCBvciBudW1iZXIgb2YgbGlzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5jdXJzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5jdXJzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9zbSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLnNsb3dNb3Rpb24gPSBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5zbG93TW90aW9uID09IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKICAgICAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9lbmQnOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZW5kR2FtZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCgoKICAgICAgICAgICAgICAgICAgICBlbGlmIGxldmVsID4gMjoKCQkgICAgICAgICAgICBpZiBtID09ICcvcXVpdCc6CgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLnF1aXQoKQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2F1dG9hZG1pbicgYW5kIGxldmVsID4gNToKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIHZhbCA9ICIxIgoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdmFsID0gc3RyKGFbMF0pCgkJICAgICAgICAgICAgICAgIGxvdmUuYWRtaW4odmFsKQoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9hdXRvdmlwJyBhbmQgbGV2ZWwgPiA1OgoJCSAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgdmFsID0gIjIiCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB2YWwgPSBzdHIoYVswXSkKCQkgICAgICAgICAgICAgICAgbG92ZS52aXAodmFsKQoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9raWNrJzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2tpY2sgbmFtZSBvciBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsaWYgbGVuKGFbMF0pID4gMzoKCQkgICAgICAgICAgICAgICAgICAgIHNlbGYua2lja0J5TmljayhhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2Rpc2Nvbm5lY3RDbGllbnQoaW50KGFbMF0pKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2lja0J5TmljayhhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9hZG1pbicgYW5kIGxldmVsID4gNToKCQkgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5hZG1pbkhhc2hlcwoJCSAgICAgICAgICAgICAgICBmb3IgY2xpZW50IGluIGJzSW50ZXJuYWwuX2dldEdhbWVSb3N0ZXIoKToKCQkgICAgICAgICAgICAgICAgICAgIGlmIGNsaWVudFsnY2xpZW50SUQnXSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNsX3N0ciA9IGNsaWVudFsnZGlzcGxheVN0cmluZyddCgoJCSAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgbmV3YWRtaW4gPSBpLmdldF9hY2NvdW50X2lkKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiBhWzFdID09ICdhZGQnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdhZG1pbiBub3QgaW4gdXBkYXRlZF9hZG1pbnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguYWRtaW5IYXNoZXMuYXBwZW5kKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5hZG1pbkhhc2hlcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvbWVtYmVyc2lkbG9nZ2VkLnR4dCcsIG1vZGU9J2ErJykgYXMgKGZpKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaS53cml0ZShjbF9zdHIgKyAnIHx8ICcgKyBuZXdhZG1pbiArICdcbicpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmkuY2xvc2UoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVsxXSA9PSAncmVtb3ZlJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3YWRtaW4gaW4gdXBkYXRlZF9hZG1pbnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguYWRtaW5IYXNoZXMucmVtb3ZlKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5hZG1pbkhhc2hlcwoKCQkgICAgICAgICAgICAgICAgaWYgbGVuKGEpID4gMjoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMl0gPT0gJ3Blcm1hbmVudCcgYW5kIGxldmVsID4gNToKCQkgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScpIGFzIChmaWxlKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IFsgcm93IGZvciByb3cgaW4gZmlsZSBdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNbMF0gPSAnYWRtaW5IYXNoZXMgPSAnICsgc3RyKHVwZGF0ZWRfYWRtaW5zKSArICdcbicKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSkKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL21hbmFnZXInIGFuZCBsZXZlbCA+IDU6CgkJICAgICAgICAgICAgICAgIGNsSUQgPSBpbnQoYVswXSkKCQkgICAgICAgICAgICAgICAgdXBkYXRlZF9hZG1pbnMgPSBncGgubWFuYWdlcgoJCSAgICAgICAgICAgICAgICBmb3IgY2xpZW50IGluIGJzSW50ZXJuYWwuX2dldEdhbWVSb3N0ZXIoKToKCQkgICAgICAgICAgICAgICAgICAgIGlmIGNsaWVudFsnY2xpZW50SUQnXSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNsX3N0ciA9IGNsaWVudFsnZGlzcGxheVN0cmluZyddCgoJCSAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgbmV3YWRtaW4gPSBpLmdldF9hY2NvdW50X2lkKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiBhWzFdID09ICdhZGQnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdhZG1pbiBub3QgaW4gdXBkYXRlZF9hZG1pbnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGgubWFuYWdlci5hcHBlbmQobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfYWRtaW5zID0gZ3BoLm1hbmFnZXIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL21lbWJlcnNpZGxvZ2dlZC50eHQnLCBtb2RlPSdhKycpIGFzIChmaSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmkud3JpdGUoY2xfc3RyICsgJyB8fCAnICsgbmV3YWRtaW4gKyAnXG4nKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpLmNsb3NlKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFbMV0gPT0gJ3JlbW92ZSc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld2FkbWluIGluIHVwZGF0ZWRfYWRtaW5zOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLm1hbmFnZXIucmVtb3ZlKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5tYW5hZ2VyCgoJCSAgICAgICAgICAgICAgICBpZiBsZW4oYSkgPiAyOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVsyXSA9PSAncGVybWFuZW50JyBhbmQgbGV2ZWwgPiA1OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL2dldFBlcm1pc3Npb25zSGFzaGVzLnB5JykgYXMgKGZpbGUpOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1s3XSA9ICdtYW5hZ2VyID0gJyArIHN0cih1cGRhdGVkX2FkbWlucykgKyAnXG4nCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknLCAndycpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy92aXAnIGFuZCBsZXZlbCA+IDM6CgkJICAgICAgICAgICAgICAgIGNsSUQgPSBpbnQoYVswXSkKCQkgICAgICAgICAgICAgICAgdXBkYXRlZF9hZG1pbnMgPSBncGgudmlwSGFzaGVzCgkJICAgICAgICAgICAgICAgIGZvciBjbGllbnQgaW4gYnNJbnRlcm5hbC5fZ2V0R2FtZVJvc3RlcigpOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgY2xpZW50WydjbGllbnRJRCddID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgY2xfc3RyID0gY2xpZW50WydkaXNwbGF5U3RyaW5nJ10KCgkJICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgaS5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xJRDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBuZXdhZG1pbiA9IGkuZ2V0X2FjY291bnRfaWQoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFbMV0gPT0gJ2FkZCc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld2FkbWluIG5vdCBpbiB1cGRhdGVkX2FkbWluczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwaC52aXBIYXNoZXMuYXBwZW5kKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC52aXBIYXNoZXMKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL21lbWJlcnNpZGxvZ2dlZC50eHQnLCBtb2RlPSdhKycpIGFzIChmaSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmkud3JpdGUoY2xfc3RyICsgJyB8fCAnICsgbmV3YWRtaW4gKyAnXG4nKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpLmNsb3NlKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFbMV0gPT0gJ3JlbW92ZSc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld2FkbWluIGluIHVwZGF0ZWRfYWRtaW5zOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLnZpcEhhc2hlcy5yZW1vdmUobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfYWRtaW5zID0gZ3BoLnZpcEhhc2hlcwoKCQkgICAgICAgICAgICAgICAgaWYgbGVuKGEpID4gMjoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMl0gPT0gJ3Blcm1hbmVudCcgYW5kIGxldmVsID4gMjoKCQkgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScpIGFzIChmaWxlKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IFsgcm93IGZvciByb3cgaW4gZmlsZSBdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNbMV0gPSAndmlwSGFzaGVzID0gJyArIHN0cih1cGRhdGVkX2FkbWlucykgKyAnXG4nCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknLCAndycpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvcmVtb3ZlJzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL3JlbW92ZSBhbGwgb3IgbnVtYmVyIG9mIGxpc3QnKQoJCSAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2FsbCc6CgkJICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkucmVtb3ZlRnJvbUdhbWUoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbaW50KGFbMF0pXS5yZW1vdmVGcm9tR2FtZSgpCgkJICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCgoJCSAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9odWcnLCAnL2h1Z2FsbCcpOgoJCSAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvaHVnYWxsJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzBdLmFjdG9yLm5vZGUuaG9sZE5vZGUgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1sxXS5hY3Rvci5ub2RlCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbMV0uYWN0b3Iubm9kZS5ob2xkTm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzBdLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzNdLmFjdG9yLm5vZGUuaG9sZE5vZGUgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1syXS5hY3Rvci5ub2RlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzRdLmFjdG9yLm5vZGUuaG9sZE5vZGUgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1szXS5hY3Rvci5ub2RlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzVdLmFjdG9yLm5vZGUuaG9sZE5vZGUgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1s2XS5hY3Rvci5ub2RlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbNl0uYWN0b3Iubm9kZS5ob2xkTm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzddLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC9odWdhbGwgb3IgL2h1ZyBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5ub2RlLmhvbGROb2RlID0gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbaW50KGFbMV0pXS5hY3Rvci5ub2RlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvaHVnYWxsIG9yIC9odWcgbnVtYmVyIG9mIGxpc3QnKQoKCQkgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy90aW50JzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL3RpbnQgUiBHIEInKQoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ09SJykKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL3RpbnQgciBicmlnaHQgc3BlZWQnKQoJCSAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ3InOgoJCSAgICAgICAgICAgICAgICAgICAgbSA9IDEuMyBpZiBhWzFdIGlzIE5vbmUgZWxzZSBmbG9hdChhWzFdKQoJCSAgICAgICAgICAgICAgICAgICAgcyA9IDEwMDAgaWYgYVsyXSBpcyBOb25lIGVsc2UgZmxvYXQoYVsyXSkKCQkgICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuYW5pbWF0ZUFycmF5KGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLCAndGludCcsIDMsIHswOiAoMSAqIG0sIDAsIDApLCBzOiAoMCwgMSAqIG0sIDApLCBzICogMjogKDAsIDAsIDEgKiBtKSwgcyAqIDM6ICgxICogbSwgMCwgMCl9LCBUcnVlKQoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVsxXSBpcyBub3QgTm9uZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykudGludCA9ICgKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0KGFbMF0pLCBmbG9hdChhWzFdKSwgZmxvYXQoYVsyXSkpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL3BhdXNlJzoKCQkgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykucGF1c2VkID0gYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykucGF1c2VkID09IEZhbHNlCgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2NhbWVyYU1vZGUnOgoJCSAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICBpZiBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5jYW1lcmFNb2RlID09ICdmb2xsb3cnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLmNhbWVyYU1vZGUgPSAncm90YXRlJwoJCSAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5jYW1lcmFNb2RlID0gJ2ZvbGxvdycKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2xtJzoKCQkgICAgICAgICAgICAgICAgYXJyID0gW10KCQkgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMTAwKToKCQkgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICBhcnIuYXBwZW5kKGJzSW50ZXJuYWwuX2dldENoYXRNZXNzYWdlcygpWygtMSAtIGkpXSkKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICBhcnIucmV2ZXJzZSgpCgkJICAgICAgICAgICAgICAgIGZvciBpIGluIGFycjoKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKGkpCgoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9ncCc6CgkJICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNpbmc6IC9ncCBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICBzID0gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkKCQkgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHMucGxheWVyc1tpbnQoYVswXSldLmdldElucHV0RGV2aWNlKCkuX2dldFBsYXllclByb2ZpbGVzKCk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZShpKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2ljeSc6CgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzW2ludChhWzFdKV0uYWN0b3Iubm9kZQoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gaW4gKCcvZmx5JywgJy9mbHlhbGwnKToKCQkgICAgICAgICAgICAgICAgaWYgbSA9PSAnL2ZseWFsbCc6CgkJICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuZmx5ID0gVHJ1ZQoKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICBlbGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEhIFVzYWdlOiAvZmx5YWxsIG9yIC9mbHkgbnVtYmVyIG9mIGxpc3QnKQoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5mbHkgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuZmx5ID09IEZhbHNlCgkJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhISBVc2FnZTogL2ZseWFsbCBvciAvZmx5IG51bWJlciBvZiBsaXN0JykKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvZmxvb3JSZWZsZWN0aW9uJzoKCQkgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykuZmxvb3JSZWZsZWN0aW9uID0gYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykuZmxvb3JSZWZsZWN0aW9uID09IEZhbHNlCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvYWMnOgoJCSAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzaW5nOiAvYWMgUiBHIEInKQoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ09SJykKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2FjIHIgYnJpZ2h0IHNwZWVkJykKCQkgICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICdyJzoKCQkgICAgICAgICAgICAgICAgICAgIG0gPSAxLjMgaWYgYVsxXSBpcyBOb25lIGVsc2UgZmxvYXQoYVsxXSkKCQkgICAgICAgICAgICAgICAgICAgIHMgPSAxMDAwIGlmIGFbMl0gaXMgTm9uZSBlbHNlIGZsb2F0KGFbMl0pCgkJICAgICAgICAgICAgICAgICAgICBic1V0aWxzLmFuaW1hdGVBcnJheShicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKSwgJ2FtYmllbnRDb2xvcicsIDMsIHswOiAoMSAqIG0sIDAsIDApLCBzOiAoMCwgMSAqIG0sIDApLCBzICogMjogKDAsIDAsIDEgKiBtKSwgcyAqIDM6ICgxICogbSwgMCwgMCl9LCBUcnVlKQoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFbMV0gaXMgbm90IE5vbmU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLmFtYmllbnRDb2xvciA9ICgKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0KGFbMF0pLCBmbG9hdChhWzFdKSwgZmxvYXQoYVsyXSkpCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvaWNlT2ZmJzoKCQkgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkuZ2V0TWFwKCkubm9kZS5tYXRlcmlhbHMgPSBbCgkJICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdmb290aW5nTWF0ZXJpYWwnKV0KCQkgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LmdldE1hcCgpLmlzSG9ja2V5ID0gRmFsc2UKCQkgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LmdldE1hcCgpLmZsb29yLm1hdGVyaWFscyA9IFsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdmb290aW5nTWF0ZXJpYWwnKV0KCQkgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5nZXRNYXAoKS5pc0hvY2tleSA9IEZhbHNlCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGFjdGl2aXR5LnBsYXllcnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhvY2tleSA9IEZhbHNlCgoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9tYXhQbGF5ZXJzJyBhbmQgbGV2ZWwgPjM6CgkJICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNpbmc6IC9tYXhQbGF5ZXJzIGNvdW50IG9mIHBsYXllcnMnKQoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0U2Vzc2lvbigpLl9tYXhQbGF5ZXJzID0gaW50KGFbMF0pCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fc2V0UHVibGljUGFydHlNYXhTaXplKGludChhWzBdKSkKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnTWF4aW11bSBwbGF5ZXJzIHNldCB0byAnICsgc3RyKGludChhWzBdKSkpCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9oZWFsJywgJy9oZWFsYWxsJyk6CgkJICAgICAgICAgICAgICAgIGlmIG0gPT0gJy9oZWFsYWxsJzoKCQkgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuYWN0b3IuZXhpc3RzKCk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZShicy5Qb3dlcnVwTWVzc2FnZShwb3dlcnVwVHlwZSA9J2hlYWx0aCcpKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCgkJICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2hlYWxhbGwgb3IgL2hlYWwgbnVtYmVyIG9mIGxpc3QnKQoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldEFjdGl2aXR5KCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZShicy5Qb3dlcnVwTWVzc2FnZShwb3dlcnVwVHlwZSA9J2hlYWx0aCcpKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC9oZWFsYWxsIG9yIC9oZWFsIG51bWJlciBvZiBsaXN0JykKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvZ20nOgoJCSAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihhY3Rpdml0eS5wbGF5ZXJzKSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFjdGl2aXR5LnBsYXllcnNbaV0uZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsaWVudElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkucGxheWVyc1tpXS5hY3Rvci5ub2RlLmhvY2tleSA9IGFjdGl2aXR5LnBsYXllcnNbaV0uYWN0b3Iubm9kZS5ob2NrZXkgPT0gRmFsc2UKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnBsYXllcnNbaV0uYWN0b3Iubm9kZS5pbnZpbmNpYmxlID0gYWN0aXZpdHkucGxheWVyc1tpXS5hY3Rvci5ub2RlLmludmluY2libGUgPT0gRmFsc2UKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnBsYXllcnNbaV0uYWN0b3IuX3B1bmNoUG93ZXJTY2FsZSA9IDUgaWYgYWN0aXZpdHkucGxheWVyc1tpXS5hY3Rvci5fcHVuY2hQb3dlclNjYWxlID09IDEuMiBlbHNlIDEuMgoKCQkgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaG9ja2V5ID0gYWN0aXZpdHkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaG9ja2V5ID09IEZhbHNlCgkJICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaW52aW5jaWJsZSA9IGFjdGl2aXR5LnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5ub2RlLmludmluY2libGUgPT0gRmFsc2UKCQkgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3IuX3B1bmNoUG93ZXJTY2FsZSA9IDUgaWYgYWN0aXZpdHkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLl9wdW5jaFBvd2VyU2NhbGUgPT0gMS4yIGVsc2UgMS4yCgkJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdQTEFZRVIgTk9UIEZPVU5EJykKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvcmVmbGVjdGlvbnMnOgoJCSAgICAgICAgICAgICAgICBpZiBsZW4oYSkgPCAyOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWdlOiAvcmVmbGVjdGlvbnMgdHlwZSgxLzApIHNjYWxlJykKCQkgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgIHJzID0gWwoJCSAgICAgICAgICAgICAgICAgICAgIGludChhWzFdKV0KCQkgICAgICAgICAgICAgICAgICAgIHR5cGVlID0gJ3NvZnQnIGlmIGludChhWzBdKSA9PSAwIGVsc2UgJ3Bvd2VydXAnCgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLm5vZGUucmVmbGVjdGlvbiA9IHR5cGVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLm5vZGUucmVmbGVjdGlvblNjYWxlID0gcnMKCQkgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnbm9kZScKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmJnLnJlZmxlY3Rpb24gPSB0eXBlZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuYmcucmVmbGVjdGlvblNjYWxlID0gcnMKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2JnJwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5mbG9vci5yZWZsZWN0aW9uID0gdHlwZWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5mbG9vci5yZWZsZWN0aW9uU2NhbGUgPSBycwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Zsb29yJwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmNlbnRlci5yZWZsZWN0aW9uID0gdHlwZWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmNlbnRlci5yZWZsZWN0aW9uU2NhbGUgPSBycwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY2VudGVyJwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL3NoYXR0ZXInOgoJCSAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzaW5nOiAvc2hhdHRlciBhbGwgb3IgbnVtYmVyIG9mIGxpc3QnKQoJCSAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2FsbCc6CgkJICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuc2hhdHRlcmVkID0gaW50KGFbMV0pCgoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuc2hhdHRlcmVkID0gaW50KGFbMV0pCgkJICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9jbSc6CgkJICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICB0aW1lID0gODAwMAoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdGltZSA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgb3AgPSAwLjA4CgkJICAgICAgICAgICAgICAgICAgICBzdGQgPSBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS52aWduZXR0ZU91dGVyCgkJICAgICAgICAgICAgICAgICAgICBic1V0aWxzLmFuaW1hdGVBcnJheShicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKSwgJ3ZpZ25ldHRlT3V0ZXInLCAzLCB7MDogYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykudmlnbmV0dGVPdXRlciwgMTcwMDA6ICgwLCAxLCAwKX0pCgkJICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmJnLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuYmcubm9kZS5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZTEub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZTIub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZTMub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLnN0ZXBzLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmZsb29yLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuY2VudGVyLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgIGRlZiBvZmYoKToKCQkgICAgICAgICAgICAgICAgICAgIG9wID0gMQoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuYmcub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmJnLm5vZGUub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZTEub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlMi5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZTMub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5zdGVwcy5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuZmxvb3Iub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuY2VudGVyLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuYW5pbWF0ZUFycmF5KGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLCAndmlnbmV0dGVPdXRlcicsIDMsIHswOiBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS52aWduZXR0ZU91dGVyLCAxMDA6IHN0ZH0pCgoJCSAgICAgICAgICAgICAgICBicy5nYW1lVGltZXIodGltZSwgYnMuQ2FsbChvZmYpKQoJCQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL3J1bGVzJzoKCQkgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tUnVsZXMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIsY29sb3I9KDEsMSwxKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCQkgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgiUmVzcGVjdCBBbGwgUGxheWVyc1xuTm8gVGVhbWluZ1xuTm8gQ2hlYXRpbmdcbkpvaW4gRGlzY29yZCBTZXJ2ZXIgKE5vdCBhIFJ1bGUpIixjb2xvcj0oMSwxLDEpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoJCQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2luZm8nOgoJCSAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1JbmZvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0iLGNvbG9yPSgxLDEsMSksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoIlNjcmlwdCBCeSBEZXNpcmUgXG4gVmVyc2lvbiAxLjQgXG4iLGNvbG9yPSgxLDEsMSksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJCgkJICAgICAgICAgICAgZWxpZiBsZXZlbCA+IDQ6CgkJICAgICAgICAgICAgICAgIGlmIG0gPT0gJy9wYXJ0eW5hbWUnOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgVHJ1ZToKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNhZ2U6IC9wYXJ0eW5hbWUgTmFtZSBvZiBwYXJ0eScpCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICd2YWx1ZSBvZiBhWzBdID0gJyArIGFbMF0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGFbMF0ucmVwbGFjZSgnXycsICcgJykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fc2V0UHVibGljUGFydHlOYW1lKG5hbWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnUGFydHkgbmFtZSBjaGFuZ2VkIHRvICInICsgbmFtZSArICciJykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdGYWlsZWQgVG8gQ2hhbmdlJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvc2V0dGluZ3MnOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiVXNhZ2UgL3NldHRpbmdzIChudW1iZXIgaW4gbGlzdCkgKDAsMSkiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJMaXN0IE9mIFNldHRpbmdzOiIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjEuIGFuaW1hdGUiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIyLk5pZ2h0IE1vZGUiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIzLkVuYWJsZSBPciBEaXNhYmxlIFN0YXRzIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiNC5Db2luIFN5c3RlbSIpCgkJICAgICAgICAgICAgICAgICAgICB0ID0gaW50KGFbMV0pCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIxIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICBsb3ZlLmFUKHQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIyIjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLm5NKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIzIjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLnNTKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICI0IjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLmNTKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgoKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvcHVibGljJzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIFRydWU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWdlOiAvcHVibGljIDAgb3IgMScpCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICcwJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fc2V0UHVibGljUGFydHlFbmFibGVkKEZhbHNlKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1BhcnR5IGlzIFByaXZhdGUnKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0ZhaWxlZCBUbyBDaGFuZ2UnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnMSc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX3NldFB1YmxpY1BhcnR5RW5hYmxlZChUcnVlKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1BhcnR5IGlzIFB1YmxpYycpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRmFpbGVkIFRvIENoYW5nZScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWdlOiAvcHVibGljIDAgb3IgMScpCgkJICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL2lkJzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIFRydWU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoaS5nZXRfYWNjb3VudF9pZCgpKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL2VnZycgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIFRydWU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3YWRtaW4gPSBpLmdldF9hY2NvdW50X2lkKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFbMV0gPT0gJ2FkZCc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmVnZy5hcHBlbmQobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFbMV0gPT0gJ3JlbW92ZSc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3YWRtaW4gaW4gZ3BoLmVnZzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmVnZy5yZW1vdmUobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9ydWluZScgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIFRydWU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3YWRtaW4gPSBpLmdldF9hY2NvdW50X2lkKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFbMV0gPT0gJ2FkZCc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1cnNlZC5hcHBlbmQobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFbMV0gPT0gJ3JlbW92ZSc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3YWRtaW4gaW4gZ3BoLmN1cnNlZDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1cnNlZC5yZW1vdmUobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKCgkJICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL2N1c3RvbXRhZyc6CgkJICAgICAgICAgICAgICAgICAgICBpZiBUcnVlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNsSUQgPSBpbnQoYVswXSkKCQkgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xJRDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld2FkbWluID0gaS5nZXRfYWNjb3VudF9pZCgpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhWzFdID09ICdhZGQnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b210YWdIYXNoZXMuYXBwZW5kKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhWzFdID09ICdyZW1vdmUnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld2FkbWluIGluIGdwaC5kcmFnb25IYXNoZXM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b210YWdIYXNoZXMucmVtb3ZlKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCgkJICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL2NsZWFyJzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIFRydWU6CgkJICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1c3RvbWxpc3QgPSBbXQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b210YWdIYXNoZXMgPSBbXQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5kcmFnb25IYXNoZXMgPSBbXQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5hZG1pbkhhc2hlcyA9IFtdCgkJICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmVnZyA9IFtdCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9iYW4nOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgYSAhPSBbXToKCQkgICAgICAgICAgICAgICAgICAgICAgICBiYW5uZWRJZCA9IE5vbmUKCQkJCQlhaWQgPSBOb25lCgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbElEID0gaW50KGFbMF0pCgkJCQkJICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEdhbWVSb3N0ZXIoKToKCQkJCQkJaWYgaVsnY2xpZW50SUQnXSA9PSBjbElEOgoJCQkJCQkgICAgYWlkID0gaVsnZGlzcGxheVN0cmluZyddCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIAkgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJaWYgaS5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xJRDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJICAgIGJhbm5lZElEID0gaS5nZXRfYWNjb3VudF9pZCgpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCSAgICBuYW1lID0gaS5nZXROYW1lKCkKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFpZCBpcyBub3QgTm9uZToKCQkJCQkJZ3BoLmJhbmxpc3RbYmFubmVkSURdID0gYWlkCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScpIGFzIChmaWxlKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWzJdID0gJ2Jhbmxpc3QgPSAnICsgc3RyKGdwaC5iYW5saXN0KSArICdcbicKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL2dldFBlcm1pc3Npb25zSGFzaGVzLnB5JywgJ3cnKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdiYW5uZWQgJyArIG5hbWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9kaXNjb25uZWN0Q2xpZW50KGNsSUQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgncGxheWVyIG5vdCBmb3VuZCcpCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9jdXN0b20nOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSBsZW4oYSkKCQkgICAgICAgICAgICAgICAgICAgICAgICBjbElEID0gaW50KGFbMF0pCgkJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21lciA9IGkuZ2V0X2FjY291bnRfaWQoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVsxXSA9PSAnYWRkJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXN0b21lciBpbiBncGguY3VzdG9tbGlzdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1c3RvbWxpc3QucG9wKGN1c3RvbWVyKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0cmlidXRlcyA+IDI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWcgPSBhWzJdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnXFwnIGluIHRhZzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWcgPSB0YWcucmVwbGFjZSgnXFxkJywgKCdcXHVlMDQ4JykuZGVjb2RlKCd1bmljb2RlLWVzY2FwZScpKSAJI0RyYWdvbgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZyA9IHRhZy5yZXBsYWNlKCdcXGMnLCAoJ1xcdWUwNDMnKS5kZWNvZGUoJ3VuaWNvZGUtZXNjYXBlJykpCSNDcm93bgkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWcgPSB0YWcucmVwbGFjZSgnXFxoJywgKCdcXHVlMDQ5JykuZGVjb2RlKCd1bmljb2RlLWVzY2FwZScpKQkjSGVsbWV0CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnID0gdGFnLnJlcGxhY2UoJ1xccycsICgnXFx1ZTA0NicpLmRlY29kZSgndW5pY29kZS1lc2NhcGUnKSkJI3NrdWxsCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnID0gdGFnLnJlcGxhY2UoJ1xcbicsICgnXFx1ZTA0YicpLmRlY29kZSgndW5pY29kZS1lc2NhcGUnKSkJI25pbmphIHN0YXIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWcgPSB0YWcucmVwbGFjZSgnXFxmJywgKCdcXHVlMDRmJykuZGVjb2RlKCd1bmljb2RlLWVzY2FwZScpKQkjZmlyZWJhbGwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b21saXN0W2N1c3RvbWVyXSA9IHRhZwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0cmlidXRlcyA+IDM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVszXSA9PSAncGVybWFuZW50JyBhbmQgbGV2ZWwgPiA1OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScpIGFzIChmaWxlKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBbIHJvdyBmb3Igcm93IGluIGZpbGUgXQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1s1XSA9ICdjdXN0b21saXN0ID0gJyArIHN0cihncGguY3VzdG9tbGlzdCkgKyAnXG4nCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL2dldFBlcm1pc3Npb25zSGFzaGVzLnB5JywgJ3cnKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnaW5zaWRlIGV4Y2VwdGlvbiBidXQgYWRkaW5nIGludG8gY3VzdG9tSGFzaGVzJwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguY3VzdG9tdGFnSGFzaGVzLmFwcGVuZChjdXN0b21lcikKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFbMV0gPT0gJ3JlbW92ZSc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY3VzdG9tZXIgaW4gZ3BoLmN1c3RvbXRhZ0hhc2hlczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1c3RvbXRhZ0hhc2hlcy5yZW1vdmUoY3VzdG9tZXIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN1c3RvbWVyIGluIGdwaC5jdXN0b21saXN0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguY3VzdG9tbGlzdC5wb3AoY3VzdG9tZXIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGF0dHJpYnV0ZXMgPiAyOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhWzJdID09ICdwZXJtYW5lbnQnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknKSBhcyAoZmlsZSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IFsgcm93IGZvciByb3cgaW4gZmlsZSBdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1s1XSA9ICdjdXN0b21saXN0ID0gJyArIHN0cihncGguY3VzdG9tbGlzdCkgKyAnXG4nCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQoKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy93aG9pcyc6CgkJCQkJdHJ5OgoJCQkJCQljbElEID0gaW50KGFbMF0pCgkJCQkJCUlEID0gJycKCQkJCSAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkJCSAgICAgICAgICAgICAgICAgICAgaWYgaS5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xJRDoKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgIElEID0gaS5nZXRfYWNjb3VudF9pZCgpCgkJCQkJCQluYW1lID0gaS5nZXROYW1lKFRydWUsVHJ1ZSkKCQkJCQkJaWYgSUQgaXMgbm90ICcnOgoJCQkJCQkgICAgd2l0aCBvcGVuKCdsb2dQbGF5ZXJzLmpzb24nLCdyJykgYXMgZjoKCQkJCQkJCWFsbFBsYXllcnMgPSBqc29uLmxvYWRzKGYucmVhZCgpKQoJCQkJCQkJYWxsSUQgPSBhbGxQbGF5ZXJzW0lEXQoJCQkJCQkJc3RyaW5nID0gJ0xvZ2luIElEIG9mICVzIGlzOicgJW5hbWUKCQkJCQkJCWZvciBpIGluIGFsbElEOgoJCQkJCQkJCSNic0ludGVybmFsLl9jaGF0TWVzc2FnZShpKQoJCQkJCQkJCXN0cmluZyArPSAnXG4nICsgaQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgCSNjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkJCQkJCWJzLnNjcmVlbk1lc3NhZ2Uoc3RyaW5nLCB0cmFuc2llbnQ9VHJ1ZSwgY29sb3I9KDEsIDEsIDEpKQoJCQkJCWV4Y2VwdDoKCQkJCQkJcHJpbnQgJ3dobyBpcyBleGNlcHRpb24nCgkJCQkJCQkKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvdGV4dCc6CgkJCQkJZnJvbSBCc1RleHRPbk1hcCBpbXBvcnQgdGV4dHMKCQkJCQlpZiBhID09IFtdOgoJCQkJCQlic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiVXNhZ2U6IC90ZXh0IHNob3dhbGwgb3IgL3RleHQgYWRkIFt0ZXh0XSBvciAvdGV4dCBkZWwgW3RleHRudW1iZXJdIikKCQkJCQllbGlmIGFbMF0gPT0gJ2FkZCcgYW5kIGxlbihhKT4xOgoJCQkJCQkjZ2V0IHdob2xlIHNlbnRlbmNlIGZyb20gYXJndW1lbnQgbGlzdAoJCQkJCQluZXdUZXh0ID0gdScnCgkJCQkJCWZvciBpIGluIHJhbmdlKDEsbGVuKGEpKToKCQkJCQkJCW5ld1RleHQgKz0gYVtpXSArICcgJwoJCQkJCQkjcHJpbnQgbmV3VGV4dAoJCQkJCQl0ZXh0cy5hcHBlbmQobmV3VGV4dCkKCgkJCQkJCSN3cml0ZSB0byBmaWxlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9Cc1RleHRPbk1hcC5weScpIGFzIChmaWxlKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWzBdID0gJ3RleHRzID0gJyArIHN0cih0ZXh0cykgKyAnXG4nCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9Cc1RleHRPbk1hcC5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCgkJCQkJCSAgICBjb21tYW5kU3VjY2Vzcz1UcnVlCgkJCQkJZWxpZiBhWzBdID09ICdzaG93YWxsJzoKCQkJCQkJZm9yIGkgaW4gcmFuZ2UobGVuKHRleHRzKSk6CgkJCQkJCQkjcHJpbnQgdGV4dHMoaSkKCQkJCQkJCWJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHN0cihpKSArICcuICcgKyB0ZXh0c1tpXSkKCQkJCQkJY29tbWFuZFN1Y2Nlc3M9VHJ1ZQoJCQkJCWVsaWYgYVswXSA9PSAnZGVsJyBhbmQgbGVuKGEpPjE6CgkJCQkJICAgIHRyeToKCQkJCQkJaWYgbGVuKHRleHRzKSA+IDE6CgkJCQkJCQl0ZXh0cy5wb3AoaW50KGFbMV0pKQoJCQkJCQkJI3dyaXRlIHRvIGZpbGUKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL0JzVGV4dE9uTWFwLnB5JykgYXMgKGZpbGUpOgoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBbIHJvdyBmb3Igcm93IGluIGZpbGUgXQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNbMF0gPSAndGV4dHMgPSAnICsgc3RyKHRleHRzKSArICdcbicKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL0JzVGV4dE9uTWFwLnB5JywgJ3cnKQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHM6CgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSkKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKCQkJCQkJCSAgICBjb21tYW5kU3VjY2Vzcz1UcnVlCgkJCQkJCWVsc2U6CgkJCQkJCQlicy5zY3JlZW5NZXNzYWdlKCdBdCBsZWFzdCBvbmUgdGV4dCB0byBzaG91bGQgYmUgcHJlc2VudCcsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCQkJCQkgICAgZXhjZXB0OgoJCQkJCQlwYXNzCgkJCQkJZWxzZToKCQkJCQkJYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIlVzYWdlOiAvdGV4dCBzaG93YWxsIG9yIC90ZXh0IGFkZCBbdGV4dF0gb3IgL3RleHQgZGVsIFt0ZXh0bnVtYmVyXSIpCgkJICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL3dob2lucXVldWUnOgoJCQkJICAgICAgICBkZWYgX29uUXVldWVRdWVyeVJlc3VsdChyZXN1bHQpOgoJCQkJCSAgICAjcHJpbnQgcmVzdWx0LCAnIGlzIHJlc3VsdCcKCQkJCQkgICAgaW5RdWV1ZSA9IHJlc3VsdFsnZSddCgkJCQkJICAgICNwcmludCBpblF1ZXVlLCAnIGlzIGluUXVldWUnCgkJCQkJICAgIHN0cmluZyA9ICdObyBvbmUgJwoJCQkJCSAgICBpZiBpblF1ZXVlICE9IFtdOgoJCQkJCQlzdHJpbmcgPSAnJwoJCQkJCQlmb3IgcXVldWUgaW4gaW5RdWV1ZToKCQkJCQkJCSNwcmludCBxdWV1ZVszXQoJCQkJCQkJc3RyaW5nICs9IHF1ZXVlWzNdICsgJyAnCgkJCQkJICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHN0cmluZyArICdpcyBpbiB0aGUgcXVldWUnKQoJCQkJCQkJCgkJCQkJYnNJbnRlcm5hbC5fYWRkVHJhbnNhY3Rpb24oCgkJCQkJCXsndHlwZSc6ICdQQVJUWV9RVUVVRV9RVUVSWScsICdxJzogInBfUy1sMTUwYTdhMWQtMGYxMi00M2RlLWEzYmYtNDY3YTdhNWJjZDcyXzEwMjkyOTVfMTMuMjMzLjExNi4zMl80MzIxMCJ9LAoJCQkJCQljYWxsYmFjaz1icy5DYWxsKF9vblF1ZXVlUXVlcnlSZXN1bHQpKQoJCQkJCWJzSW50ZXJuYWwuX3J1blRyYW5zYWN0aW9ucygpCQkJCQkKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0ZhaWxlZCEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCiAgICAgICAgcmV0dXJuCgoKYyA9IGNoYXRPcHRpb25zKCkKCgpkZWYgY21kKG1zZywgY2xpZW50SUQpOgogICAgYy5vcHQoY2xpZW50SUQsIG1zZykKICAgIGlmIGNvbW1hbmRTdWNjZXNzOgogICAgICAgIGlmIGNvbW1hbmRCeUNvaW46CiAgICAgICAgICAgIGNvaW5TeXN0ZW0uYWRkQ29pbnModXNlciwgY29zdE9mQ29tbWFuZCAqIC0xKQogICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnU3VjY2VzcyEgVGhhdCBjb3N0IHlvdSAnICsgYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgc3RyKGNvc3RPZkNvbW1hbmQpKQogICAgICAgIGVsc2U6CgkgIHRyeToKCQl3aXRoIGJzLkNvbnRleHQoYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpKToKCQkJYnMuc2NyZWVuTWVzc2FnZShyZXBseSwgY29sb3I9KDAuMSwxLDAuMSkpCiAgICAgICAgICAgIAkJI2JzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHJlcGx5KQoJICBleGNlcHQ6CgkJcGFzcwogICAgcmV0dXJuCg=="))