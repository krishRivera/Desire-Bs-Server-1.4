#If you have any problem or got bug contact me on discord 
# Discord id :- Desire#2365

exec('import re,base64,string')
exec(base64.b64decode("aW1wb3J0IGJzCmltcG9ydCBic0ludGVybmFsCmltcG9ydCBic1Bvd2VydXAKaW1wb3J0IGJzVXRpbHMKaW1wb3J0IHJhbmRvbQppbXBvcnQgZ2V0UGVybWlzc2lvbnNIYXNoZXMgYXMgZ3BoCmltcG9ydCBqc29uCmltcG9ydCBjb2luU3lzdGVtCmZyb20gdGhyZWFkaW5nIGltcG9ydCBUaW1lcgppbXBvcnQgbG92ZQpmcm9tIHNldHRpbmdzIGltcG9ydCAqCmltcG9ydCBoYWNrCgpyZXBseSA9IE5vbmUKCmNsYXNzIEN1c3RvbShvYmplY3QpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpZCwgdGFnKToKICAgICAgICBzZWxmLmlkID0gaWQKICAgICAgICBzZWxmLnRhZyA9IHRhZwoKCmRlZiBtYWtlX2N1c3RvbShpZCwgdGFnKToKICAgIGN1c3RvbSA9IEN1c3RvbShpZCwgdGFnKQogICAgcmV0dXJuIGN1c3RvbQoKCmNsYXNzIGNoYXRPcHRpb25zKG9iamVjdCk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuYWxsID0gVHJ1ZQogICAgICAgIHNlbGYudGludCA9IE5vbmUKICAgICAgICByZXR1cm4KCiAgICBkZWYgY2hlY2tEZXZpY2Uoc2VsZiwgY2xpZW50SUQsIGNvbW1hbmQpOgogICAgICAgIGdsb2JhbCBjb21tYW5kQnlDb2luCiAgICAgICAgZ2xvYmFsIGNvbW1hbmRTdWNjZXNzCiAgICAgICAgZ2xvYmFsIGNvc3RPZkNvbW1hbmQKICAgICAgICBnbG9iYWwgcmVwbHkKICAgICAgICBnbG9iYWwgdXNlcgogICAgICAgIGNvbW1hbmRCeUNvaW4gPSBOb25lCiAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBOb25lCglyZXBseSA9IE5vbmUKICAgICAgICBjbGllbnRfc3RyID0gJycKICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbGllbnRJRDoKICAgICAgICAgICAgICAgIGNsaWVudF9zdHIgPSBpLmdldF9hY2NvdW50X2lkKCkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBjbGllbnRfc3RyIGluIGdwaC5vd25lckhhc2hlczoKICAgICAgICAgICAgCWJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHUiXHVlMDQzfE9XTkVSIENPTU1BTkQgQUNDRVBURUR8XHVlMDQzIikKICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHUnXHVlMDBjIFNjcmlwdCBCeSBEZXNpcmUgXHVlMDBjIHx8IExpbmsgOi0gaHR0cHM6Ly9naXRodWIuY29tL1N1ZG8tRGVzaWVyL0Rlc2lyZS1Ccy1TZXJ2ZXItMS40JykKCQkjcmVwbHkgPSAnOiknCiAgICAgICAgICAgICAgICByZXR1cm4gMTAKICAgICAgICAgICAgZWxpZiBjbGllbnRfc3RyIGluIGdwaC5hZG1pbkhhc2hlczoKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSh1J1x1ZTA0OHwgQURNSU4gQ09NTUFORCBBQ0NFUFRFRCB8XHVlMDQ4JykKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSh1J1x1ZTAwYyBTY3JpcHQgQnkgRGVzaXJlIFx1ZTAwYyB8fCBMaW5rIDotIGh0dHBzOi8vZ2l0aHViLmNvbS9TdWRvLURlc2llci9EZXNpcmUtQnMtU2VydmVyLTEuNCcpCgkJICAgICNyZXBseSA9ICc6KScKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMwogICAgICAgICAgICBlbGlmIGNsaWVudF9zdHIgaW4gZ3BoLnZpcEhhc2hlczoKICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSh1J1x1ZTAwY3xWSVAgQ09NTUFORCBBQ0NFUFRFRHxcdWUwMGMnKQogICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHUnXHVlMDBjIFNjcmlwdCBCeSBEZXNpcmUgXHVlMDBjIHx8IExpbmsgOi0gaHR0cHM6Ly9naXRodWIuY29tL1N1ZG8tRGVzaWVyL0Rlc2lyZS1Ccy1TZXJ2ZXItMS40JykKCQkgICAgI3JlcGx5ID0gJzopJwogICAgICAgICAgICAgICAgICAgIHJldHVybiAyCiAgICAgICAgICAgIGVsaWYgZW5hYmxlQ29pblN5c3RlbSBhbmQgY29tbWFuZCBpbiBhdmFpbGFibGVDb21tYW5kczoKICAgICAgICAgICAgICAgICAgICBjb3N0T2ZDb21tYW5kID0gYXZhaWxhYmxlQ29tbWFuZHNbY29tbWFuZF0KICAgICAgICAgICAgICAgICAgICBoYXZlQ29pbnMgPSBjb2luU3lzdGVtLmdldENvaW5zKGNsaWVudF9zdHIpCiAgICAgICAgICAgICAgICAgICAgaWYgaGF2ZUNvaW5zID49IGNvc3RPZkNvbW1hbmQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRCeUNvaW4gPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIgPSBjbGllbnRfc3RyCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1lvdSBuZWVkICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoY29zdE9mQ29tbWFuZCkgKyAnIGZvciB0aGF0LiBZb3UgaGF2ZSAnICsgYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgc3RyKGhhdmVDb2lucykgKyAnIG9ubHkuJykKICAgICAgICAgICAgZWxpZiBlbmFibGVUb3A1Y29tbWFuZHMgYW5kIGNsaWVudF9zdHIgaW4gZ3BoLnRvcHBlcnNsaXN0OgogICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSh1J1x1ZTAwYyBUT1AgNSBQTEFZRVIsIENPTU1BTkQgQUNDRVBURUQgXHVlMDBjJykKICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UodSdcdWUwMGMgU2NyaXB0IEJ5IERlc2lyZSBcdWUwMGMgfHwgTGluayA6LSBodHRwczovL2dpdGh1Yi5jb20vU3Vkby1EZXNpZXIvRGVzaXJlLUJzLVNlcnZlci0xLjQnKQoJCSAgICAgICAgI3JlcGx5ID0gJzopJwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICByZXR1cm4gMAoKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgcmV0dXJuIDAKCiAgICBkZWYga2lja0J5TmljayhzZWxmLCBuaWNrKToKICAgICAgICByb3N0ZXIgPSBic0ludGVybmFsLl9nZXRHYW1lUm9zdGVyKCkKICAgICAgICBmb3IgaSBpbiByb3N0ZXI6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGlbJ3BsYXllcnMnXVswXVsnbmFtZUZ1bGwnXS5sb3dlcigpLmZpbmQobmljay5lbmNvZGUoJ3V0Zi04JykubG93ZXIoKSkgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZGlzY29ubmVjdENsaWVudChpbnQoaVsnY2xpZW50SUQnXSkpIAogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgZGVmIG9wdChzZWxmLCBjbGllbnRJRCwgbXNnKToKICAgICAgICBnbG9iYWwgY29tbWFuZFN1Y2Nlc3MKICAgICAgICBtID0gbXNnLnNwbGl0KCcgJylbMF0KICAgICAgICBhID0gbXNnLnNwbGl0KCcgJylbMTpdCiAgICAgICAgYWN0aXZpdHkgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkKICAgICAgICB3aXRoIGJzLkNvbnRleHQoYWN0aXZpdHkpOgogICAgICAgICAgICBzZW5kZXIgPSBOb25lCiAgICAgICAgICAgIGZvciBpIGluIGFjdGl2aXR5LnBsYXllcnM6CiAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbGllbnRJRDoKICAgICAgICAgICAgICAgICAgICBzZW5kZXIgPSBpLmdldE5hbWUoKQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZShzZW5kZXIgKyAnOicgKyBtc2csIGNvbG9yPSgwLCAwLjQsIDAuOCkpCgkJcGFzcwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICBsZXZlbCA9IHNlbGYuY2hlY2tEZXZpY2UoY2xpZW50SUQsIG0pCiAgICAgICAgICAgIGlmIG0gaW4gKCcvc3RhdHMnLCAnL3JhbmsnLCAnL215c2VsZicsICcvbWUnKToKICAgICAgICAgICAgICAgIGZvciBwbGF5ZXIgaW4gYWN0aXZpdHkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsaWVudElEOgogICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL3BTdGF0cy5qc29uJywgJ3InKQogICAgICAgICAgICAgICAgICAgICAgICBwYXRzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElEID0gcGxheWVyLmdldF9hY2NvdW50X2lkKCkKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIGVuYWJsZUNvaW5TeXN0ZW06IGhhdmVDb2lucyA9IGNvaW5TeXN0ZW0uZ2V0Q29pbnMoYWNjb3VudElEKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBhY2NvdW50SUQgaW4gcGF0czoKCQkJICAgIGlmIGVuYWJsZUNvaW5TeXN0ZW06CgkJCQloYXZlQ29pbnMgPSBjb2luU3lzdGVtLmdldENvaW5zKGFjY291bnRJRCkKCQkJICAgIAlzdHJpbmcgPSAnfHwgJyArIHBsYXllci5nZXROYW1lKCkgKyAnIHwgV2FsbGV0OicgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoaGF2ZUNvaW5zKSArICcgfCBSYW5rOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsncmFuayddICsgJyB8IEdhbWVzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsnZ2FtZXMnXSArICcgfCBTY29yZTonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ3Njb3JlcyddICsgJyB8IEtpbGxzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsna2lsbHMnXSArICcgfCBEZWF0aHM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydkZWF0aHMnXSArICcgfHwnCgkJCSAgICBlbHNlOgoJCQkgICAgCXN0cmluZyA9ICd8fCAnICsgcGxheWVyLmdldE5hbWUoKSArICAnIHwgUmFuazonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ3JhbmsnXSArICcgfCBHYW1lczonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ2dhbWVzJ10gKyAnIHwgU2NvcmU6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydzY29yZXMnXSArICcgfCBLaWxsczonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ2tpbGxzJ10gKyAnIHwgRGVhdGhzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsnZGVhdGhzJ10gKyAnIHx8JwoJCQkgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2Uoc3RyaW5nKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnfHwgJyArIHBsYXllci5nZXROYW1lKCkgKyAnIHwgV2FsbGV0OicgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoaGF2ZUNvaW5zKSArICcgfCBSYW5rOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsncmFuayddICsgJyB8IEdhbWVzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsnZ2FtZXMnXSArICcgfCBTY29yZTonICsgcGF0c1tzdHIoYWNjb3VudElEKV1bJ3Njb3JlcyddICsgJyB8IEtpbGxzOicgKyBwYXRzW3N0cihhY2NvdW50SUQpXVsna2lsbHMnXSArICcgfCBEZWF0aHM6JyArIHBhdHNbc3RyKGFjY291bnRJRCldWydkZWF0aHMnXSArICcgfHwnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1RoZSBwbGF5ZXIgJyArIHN0cihwbGF5ZXIuZ2V0TmFtZSgpKSArICcgaXMgbm90IHlldCByZWdpc3RlcmVkJykKICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL3BzZXR0aW5ncycgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIlVzYWdlIC9wc2V0dGluZ3MgKG51bWJlciBpbiBsaXN0KSAoMCwxKSIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIkxpc3QgT2YgU2V0dGluZ3M6IikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiMS5OYW1lIE9uIFBvd2VyVXBzIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiMi5Qb3dlcnVwIFRpbWVyIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiMy5TaGllbGQgT24gUG93ZXJVcHMiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCI0LkRpc2NvIExpZ2h0cyBPbiBQb3dlclVwcyIpCgkJICAgICAgICAgICAgICAgICAgICB0ID0gaW50KGFbMV0pCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIxIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICBsb3ZlLm5QKHQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIyIjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLnBUKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIzIjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLnNQKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICI0IjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLmRQKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgIGVsaWYgKG0gPT0gJy9lbW90ZScpIG9yIChtID09ICcvZW0nKToKICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgiQXZhaWxhYmxlIEVtb3RlcyBmaXJlLCBhbmdyeSwgbG9sLCBkZWFkLCBodWgsIHdoYXQsIHBvd2VyIixjb2xvcj0oMSwxLDEpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgaWYgYVswXSA9PSAnZmlyZSc6CiAgICAgICAgICAgICAgICAgICAgcHR4dCA9IHUnXFUwMDAxRjUyNScKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnYW5ncnknOgogICAgICAgICAgICAgICAgICAgIHB0eHQgPSB1J1xVMDAwMUY0QTInCiAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ2xvbCc6CiAgICAgICAgICAgICAgICAgICAgcHR4dCA9IHUnXFUwMDAxRjYwMicKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnZGVhZCc6CiAgICAgICAgICAgICAgICAgICAgcHR4dCA9IHUnXFUwMDAxRjQ4MCcKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnaHVoJzoKICAgICAgICAgICAgICAgICAgICBwdHh0ID0gdSdcVTAwMDFGNjBGJwogICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICd3aGF0JzoKICAgICAgICAgICAgICAgICAgICBwdHh0ID0gdSdcVTAwMDFGNjExJwogICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICdwb3dlcic6CiAgICAgICAgICAgICAgICAgICAgcHR4dCA9IHUnXFUwMDAxRjRBQScKICAgICAgICAgICAgICAgIGRlZiBDaWRUb0FjdG9yKGNpZCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIHMgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNpZCA9IGludChzLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGNpZCA9PSBpbnQoY2lkKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzLmFjdG9yCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIGJzVXRpbHMuUG9wdXBUZXh0KHB0eHQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9Mi4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb249Q2lkVG9BY3RvcihjbGllbnRJRCkubm9kZS5wb3NpdGlvbikuYXV0b1JldGFpbigpCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL3RlYW1OYW1lJyBhbmQgbGV2ZWwgPiAzOgogICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCJUcnkgL3RlYW1OYW1lIFJlZCBCbHVlIixjb2xvcj0oMSwxLDEpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHUiRmV3IEVtb3RlcyBcVTAwMDFGNDgwLFx1ZTAwYyxcdWUwNDgsXHVlMDQ2LFx1ZTA0MyIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvdmUudE4oYVswXSxhWzFdKQogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICBlbGlmIG0gPT0gJy9ic2V0dGluZ3MnIGFuZCBsZXZlbCA+IDM6CgkJICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJVc2FnZSAvYnNldHRpbmdzIChudW1iZXIgaW4gbGlzdCkgKDAsMSkiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJMaXN0IE9mIFNldHRpbmdzOiIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjEuTmFtZSBPbiBCb21iIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiMi5Cb21iTGlnaHRzIikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiMy5TaGllbGQgb24gQm9tYiIpCgkJICAgICAgICAgICAgICAgICAgICB0ID0gaW50KGFbMV0pCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIxIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICBsb3ZlLmJOKHQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIyIjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLmJMKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBpZiBhWzBdID09ICIzIjoKCQkgICAgICAgICAgICAgICAgICAgIAlsb3ZlLnNCKHQpCgkJICAgICAgICAgICAgICAgICAgICAJY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgogICAgICAgICAgICBlbGlmIG0gPT0gJy9zbWcnOgogICAgICAgICAgICAgICAgcHR4dCA9IHN0cihhWzBdKQogICAgICAgICAgICAgICAgZGVmIENpZFRvQWN0b3IoY2lkKToKICAgICAgICAgICAgICAgICAgICBmb3IgcyBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lkID0gaW50KHMuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwY2lkID09IGludChjaWQpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuYWN0b3IKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgYnNVdGlscy5Qb3B1cFRleHQocHR4dCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj1DaWRUb0FjdG9yKGNsaWVudElEKS5ub2RlLnBvc2l0aW9uKS5hdXRvUmV0YWluKCkKICAgICAgICAgICAgZWxpZiBtID09ICcvZG9uYXRlJyBhbmQgZW5hYmxlQ29pblN5c3RlbToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oYSkgPCAyOgogICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdVc2FnZTogL2RvbmF0ZSBhbW91bnQgY2xpZW50SUQnLCB0cmFuc2llbnQ9VHJ1ZSwgY2xpZW50cz1bY2xpZW50SURdKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZmVyID0gaW50KGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRyYW5zZmVyIDwgMTAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1lvdSBjYW4gb25seSB0cmFuc2ZlciBtb3JlIHRoYW4gJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArICcxMDAuJykKCQkJICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXJzSUQgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyc0lEID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgcGxheWVyIGluIGFjdGl2aXR5LnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbElEID0gcGxheWVyLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkID0gcGxheWVyLmdldF9hY2NvdW50X2lkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNsSUQgPT0gY2xpZW50SUQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyc0lEID0gYWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjbElEID09IGludChhWzFdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlcnNJRCA9IGFpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBwbGF5ZXIuZ2V0TmFtZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIE5vbmUgbm90IGluIFtzZW5kZXJzSUQsIHJlY2VpdmVyc0lEXToKCQkJICAgIGlmIHNlbmRlcnNJRCA9PSByZWNlaXZlcnNJRDoKCQkJCWJzLnNjcmVlbk1lc3NhZ2UoJ1lvdSBjYW5cJ3QgdHJhbnNmZXIgdG8geW91ciBvd24gYWNjb3VudCcsIGNvbG9yPSgxLCAwLCAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY29pblN5c3RlbS5nZXRDb2lucyhzZW5kZXJzSUQpIDwgdHJhbnNmZXI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ05vdCBlbm91Z2ggJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArICcgdG8gcGVyZm9ybSB0cmFuc2FjdGlvbicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvaW5TeXN0ZW0uYWRkQ29pbnMoc2VuZGVyc0lELCBpbnQodHJhbnNmZXIgKiAtMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29pblN5c3RlbS5hZGRDb2lucyhyZWNlaXZlcnNJRCwgaW50KHRyYW5zZmVyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnU3VjY2Vzc2Z1bGx5IHRyYW5zZmVyZWQgJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIGFbMF0gKyAnIGludG8gJyArIG5hbWUgKyAiJ3MgYWNjb3VudC4iKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnUGxheWVyIG5vdCBGb3VuZCcsIGNvbG9yPSgxLCAwLCAwKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdVc2FnZTogL2RvbmF0ZSBhbW91bnQgY2xpZW50SUQnLCB0cmFuc2llbnQ9VHJ1ZSwgY2xpZW50cz1bY2xpZW50SURdKQoKICAgICAgICAgICAgZWxpZiBtID09ICcvYnV5JyBhbmQgZW5hYmxlQ29pblN5c3RlbToKICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWFnZTogL2J1eSBpdGVtX25hbWUnKQogICAgICAgICAgICAgICAgZWxpZiBhWzBdIGluIGF2YWlsYWJsZUVmZmVjdHM6CiAgICAgICAgICAgICAgICAgICAgZWZmZWN0ID0gYVswXQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9zdHIgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsaWVudElEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50X3N0ciA9IGkuZ2V0X2FjY291bnRfaWQoKQoKICAgICAgICAgICAgICAgICAgICBpZiBjbGllbnRfc3RyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBjb3N0T2ZFZmZlY3QgPSBhdmFpbGFibGVFZmZlY3RzW2VmZmVjdF0KICAgICAgICAgICAgICAgICAgICAgICAgaGF2ZUNvaW5zID0gY29pblN5c3RlbS5nZXRDb2lucyhjbGllbnRfc3RyKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBoYXZlQ29pbnMgPj0gY29zdE9mRWZmZWN0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJzID0gZ3BoLmVmZmVjdEN1c3RvbWVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2xpZW50X3N0ciBub3QgaW4gY3VzdG9tZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBpcnkgPSBkYXRldGltZS5ub3coKSArIHRpbWVkZWx0YShkYXlzPTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJzW2NsaWVudF9zdHJdID0geydlZmZlY3QnOiBlZmZlY3QsICdleHBpcnknOiBleHBpcnkuc3RyZnRpbWUoJyVkLSVtLSVZICVIOiVNOiVTJyl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknKSBhcyAoZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBbIHJvdyBmb3Igcm93IGluIGZpbGUgXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWzRdID0gJ2VmZmVjdEN1c3RvbWVycyA9ICcgKyBzdHIoY3VzdG9tZXJzKSArICdcbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvaW5TeXN0ZW0uYWRkQ29pbnMoY2xpZW50X3N0ciwgY29zdE9mRWZmZWN0ICogLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1N1Y2Nlc3MhIFRoYXQgY29zdCB5b3UgJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihjb3N0T2ZFZmZlY3QpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVFZmZlY3QgPSBjdXN0b21lcnNbY2xpZW50X3N0cl1bJ2VmZmVjdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnWW91IGFscmVhZHkgaGF2ZSAnICsgYWN0aXZlRWZmZWN0ICsgJyBlZmZlY3QgYWN0aXZlJyxjb2xvcj0oMSwxLDEpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1lvdSBuZWVkICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoY29zdE9mRWZmZWN0KSArICcgZm9yIHRoYXQuIFlvdSBoYXZlICcgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoaGF2ZUNvaW5zKSArICcgb25seS4nKQoKCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL2xpc3QnOgogICAgICAgICAgICAgICAgI3N0cmluZyA9IHUnPT1OYW1lPT09PT09PT1DbGllbnRJRD09PT1QbGF5ZXJJRD09XG4nCgkJc3RyaW5nID0gdSd7MDpeMTZ9ezE6XjE1fXsyOl4xMH1cbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuJy5mb3JtYXQoJ05hbWUnLCdDbGllbnRJRCcsJ1BsYXllcklEJykKICAgICAgICAgICAgICAgIGZvciBzIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0U2Vzc2lvbigpLnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgI3N0cmluZyArPSBzLmdldE5hbWUoKSAgJz09PT09PT09JyArIHN0cihzLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSkgKyAnPT09PScgKyBzdHIoYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkucGxheWVycy5pbmRleChzKSkgKyAnXG4nCgkJICAgIHN0cmluZyArPSB1J3swOl4xNn17MTpeMTV9ezI6XjEwfVxuJy5mb3JtYXQocy5nZXROYW1lKFRydWUsVHJ1ZSksIHN0cihzLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSksIHN0cihic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdFNlc3Npb24oKS5wbGF5ZXJzLmluZGV4KHMpKSkKICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2Uoc3RyaW5nLCB0cmFuc2llbnQ9VHJ1ZSwgY29sb3I9KDEsIDEsIDEpLCBjbGllbnRzPVtjbGllbnRJRF0pCgkJI3ByaW50IHN0cmluZwoJCQoKICAgICAgICAgICAgZWxpZiBtID09ICcvc2hvcCcgYW5kIGVuYWJsZUNvaW5TeXN0ZW06CiAgICAgICAgICAgICAgICBzdHJpbmcgPSAnPT1Zb3UgY2FuIGJ1eSBmb2xsb3dpbmcgaXRlbXM9PVxuJwogICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdVc2FnZTogL3Nob3AgY29tbWFuZHMgb3IgL3Nob3AgZWZmZWN0cycsIHRyYW5zaWVudD1UcnVlLCBjb2xvcj0oMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMSksIGNsaWVudHM9W2NsaWVudElEXSkKICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnZWZmZWN0cyc6CiAgICAgICAgICAgICAgICAgICAgZm9yIHggaW4gYXZhaWxhYmxlRWZmZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IHggKyAnLS0tLScgKyBicy5nZXRTcGVjaWFsQ2hhcigndGlja2V0JykgKyBzdHIoYXZhaWxhYmxlRWZmZWN0c1t4XSkgKyAnLS0tLWZvciAxIGRheVxuJwoKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKHN0cmluZywgdHJhbnNpZW50PVRydWUsIGNvbG9yPSgwLCAxLCAwKSwgY2xpZW50cz1bY2xpZW50SURdKQogICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICdjb21tYW5kcyc6CgkJICAgIHNlcGFyYXRvciA9ICcgICAgICAgICAgJwogICAgICAgICAgICAgICAgICAgIGZvciB4IGluIGF2YWlsYWJsZUNvbW1hbmRzOgogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0geCArICctLS0tJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihhdmFpbGFibGVDb21tYW5kc1t4XSkgKyBzZXBhcmF0b3IKCQkJaWYgc2VwYXJhdG9yID09ICcgICAgICAgICAgJzoKCQkJCXNlcGFyYXRvciA9ICdcbicKCQkJZWxzZToKCQkJCXNlcGFyYXRvciA9ICcgICAgICAgICAgJwogICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2Uoc3RyaW5nLCB0cmFuc2llbnQ9VHJ1ZSwgY29sb3I9KDAsIDEsIDApLCBjbGllbnRzPVtjbGllbnRJRF0pCgogICAgICAgICAgICBlbGlmIG0gPT0gJy9jYXNodG9zY29yZScgYW5kIGVuYWJsZUNvaW5TeXN0ZW06CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY29pbnMgPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICBmb3IgcGxheWVyIGluIGFjdGl2aXR5LnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBsYXllci5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xpZW50SUQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50SUQgPSBwbGF5ZXIuZ2V0X2FjY291bnRfaWQoKQoJCQkgICAgaGF2ZUNvaW5zID0gY29pblN5c3RlbS5nZXRDb2lucyhhY2NvdW50SUQpCgkJCSAgICBpZiBoYXZlQ29pbnMgPCBjb2luczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnTm90IGVub3VnaCAnICsgYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgJyB0byBwZXJmb3JtIHRoZSB0cmFuc2FjdGlvbicpCgkJCSAgICBlbGlmIGNvaW5zIDwgMTAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdZb3UgY2FuIG9ubHkgY29udmVydCBtb3JlIHRoYW4gJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArICcxMDAnKQoJCQkgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2luU3lzdGVtLmFkZENvaW5zKGFjY291bnRJRCwgY29pbnMgKiAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL3N0YXRzLmpzb24nLCAncicpCgkJCQlzdGF0cyA9IGpzb24ubG9hZHMoZi5yZWFkKCkpCgkJCQlmLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcXVpdmFsZW50U2NvcmUgPSBpbnQoY29pbnMgKiA1ICogMC45KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzW2FjY291bnRJRF1bJ3Njb3JlcyddICs9IGVxdWl2YWxlbnRTY29yZQoJCQkJZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9zdGF0cy5qc29uJywgJ3cnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoanNvbi5kdW1wcyhzdGF0cykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnVHJhbnNhY3Rpb24gU3VjY2Vzc2Z1bCcsIGNvbG9yPSgwLDEsMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2Uoc3RyKGVxdWl2YWxlbnRTY29yZSkgKyAnc2NvcmUgYWRkZWQgdG8geW91ciBhY2NvdW50IHN0YXRzLiBbMTAlIHRyYW5zYWN0aW9uIGZlZSBkZWR1Y3RlZF0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBteXN0YXRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlzdGF0cy5yZWZyZXNoU3RhdHMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCQkJCQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ1VzYWdlOiAvY2FzaHRvc2NvcmUgYW1vdW50X29mX2Nhc2gnLCB0cmFuc2llbnQ9VHJ1ZSwgY29sb3I9KDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjEpLCBjbGllbnRzPVtjbGllbnRJRF0pCgoKCiAgICAgICAgICAgIGVsaWYgbSA9PSAnL3Njb3JldG9jYXNoJyBhbmQgZW5hYmxlQ29pblN5c3RlbToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzY29yZSA9IGludChhWzBdKQogICAgICAgICAgICAgICAgICAgIGZvciBwbGF5ZXIgaW4gYWN0aXZpdHkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbGllbnRJRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvc3RhdHMuanNvbicsICdyJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRJRCA9IHBsYXllci5nZXRfYWNjb3VudF9pZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXZlU2NvcmUgPSBzdGF0c1thY2NvdW50SURdWydzY29yZXMnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoYXZlU2NvcmUgPCBzY29yZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnTm90IGVub3VnaCBzY29yZXMgdG8gcGVyZm9ybSB0aGUgdHJhbnNhY3Rpb24nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBzY29yZSA8IDUwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnWW91IGNhbiBvbmx5IGNvbnZlcnQgbW9yZSB0aGFuIDUwMHNjb3JlcycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvc3RhdHMuanNvbicsICd3JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1thY2NvdW50SURdWydzY29yZXMnXSAtPSBzY29yZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoanNvbi5kdW1wcyhzdGF0cykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXZhbGVudENvaW5zID0gaW50KHNjb3JlIC8gNSAqIDAuOSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2luU3lzdGVtLmFkZENvaW5zKGFjY291bnRJRCwgZXF1aXZhbGVudENvaW5zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ1RyYW5zYWN0aW9uIFN1Y2Nlc3NmdWwnLCBjb2xvcj0oMCwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoYnMuZ2V0U3BlY2lhbENoYXIoJ3RpY2tldCcpICsgc3RyKGVxdWl2YWxlbnRDb2lucykgKyAnIGFkZGVkIHRvIHlvdXIgYWNjb3VudC4gWzEwJSB0cmFuc2FjdGlvbiBmZWUgZGVkdWN0ZWRdJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgbXlzdGF0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15c3RhdHMucmVmcmVzaFN0YXRzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ1VzYWdlOiAvc2NvcmV0b2Nhc2ggYW1vdW50X29mX3Njb3JlJywgdHJhbnNpZW50PVRydWUsIGNvbG9yPSgxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4xKSwgY2xpZW50cz1bY2xpZW50SURdKQoKICAgICAgICAgICAgZWxpZiBsZXZlbCA+IDA6CiAgICAgICAgICAgICAgICBpZiBtID09ICcvbnYnOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYudGludCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbnQgPSBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS50aW50CiAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykudGludCA9ICgwLjUsIDAuNywgMSkgaWYgYSA9PSBbXSBvciBub3QgYVswXSA9PSAnb2ZmJyBlbHNlIHNlbGYudGludAogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgZWxpZiBtID09ICcvb29oJzoKICAgICAgICAgICAgICAgICAgICBpZiBhIGlzIG5vdCBOb25lIGFuZCBsZW4oYSkgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICBzID0gaW50KGFbMF0pCgogICAgICAgICAgICAgICAgICAgICAgICBkZWYgb29oUmVjdXJjZShjKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnBsYXlTb3VuZChicy5nZXRTb3VuZCgnb29oJyksIHZvbHVtZSA9MikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgLT0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYyA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2FtZVRpbWVyKGludChhWzFdKSBpZiBsZW4oYSkgPiAxIGFuZCBhWzFdIGlzIG5vdCBOb25lIGVsc2UgMTAwMCwgYnMuQ2FsbChvb2hSZWN1cmNlLCBjPWMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICAgICAgICAgICAgICBvb2hSZWN1cmNlKGM9cykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBicy5wbGF5U291bmQoYnMuZ2V0U291bmQoJ29vaCcpLCB2b2x1bWUgPTIpCiAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9wbGF5U291bmQnOgogICAgICAgICAgICAgICAgICAgIGlmIGEgaXMgbm90IE5vbmUgYW5kIGxlbihhKSA+IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBpbnQoYVsxXSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZiBvb2hSZWN1cmNlKGMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKHN0cihhWzBdKSksIHZvbHVtZSA9MikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgLT0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYyA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2FtZVRpbWVyKGludChhWzJdKSBpZiBsZW4oYSkgPiAyIGFuZCBhWzJdIGlzIG5vdCBOb25lIGVsc2UgMTAwMCwgYnMuQ2FsbChvb2hSZWN1cmNlLCBjPWMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICAgICAgICAgICAgICBvb2hSZWN1cmNlKGM9cykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBicy5wbGF5U291bmQoYnMuZ2V0U291bmQoc3RyKGFbMF0pKSwgdm9sdW1lID0yKQogICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL2JveCcsICcvYm94YWxsJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvYm94YWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnRvcnNvTW9kZWwgPSBicy5nZXRNb2RlbCgndG50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKCd0bnQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuY29sb3JUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgndG50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhpZ2hsaWdodCA9ICgxLCAxLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuY29sb3IgPSAoMSwgMSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhlYWRNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnN0eWxlID0gJ2N5Ym9yZycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdlcnJvcicKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWdlOiAvYm94YWxsIG9yIC9ib3ggcGxheWVyX2NvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLnRvcnNvTW9kZWwgPSBicy5nZXRNb2RlbCgndG50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKCd0bnQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuY29sb3JUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgndG50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmhpZ2hsaWdodCA9ICgxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yID0gKDEsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuc3R5bGUgPSAnY3lib3JnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FnZTogL2JveGFsbCBvciAvYm94IHBsYXllcl9jb2RlJykKCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL3NwYXonLCAnL3NwYXphbGwnKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC9zcGF6YWxsIG9yIC9zcGF6IG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvc3BhemFsbCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmFwcGVuZChhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBpLmFjdG9yLm5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJCSAgCSAgaWYgYVsxXSBpbiBbJ2FsaScsJ25lb1NwYXonLCd3aXphcmQnLCdjeWJvcmcnLCdwZW5ndWluJywnYWdlbnQnLCdwaXhpZScsJ2JlYXInLCdidW5ueSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoYVsxXSArICdDb2xvcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuY29sb3JNYXNrVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoYVsxXSArICdDb2xvck1hc2snKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhlYWRNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnSGVhZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9yc29Nb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnVG9yc28nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnBlbHZpc01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdQZWx2aXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyQXJtTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ1VwcGVyQXJtJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5mb3JlQXJtTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ0ZvcmVBcm0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhhbmRNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnSGFuZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudXBwZXJMZWdNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnVXBwZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0Lmxvd2VyTGVnTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ0xvd2VyTGVnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50b2VzTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ1RvZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN0eWxlID0gYVsxXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Vycm9yJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkJICAgICAgaWYgYVsxXSBpbiBbJ2FsaScsJ25lb1NwYXonLCd3aXphcmQnLCdjeWJvcmcnLCdwZW5ndWluJywnYWdlbnQnLCdwaXhpZScsJ2JlYXInLCdidW5ueSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuY29sb3JUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZShhWzFdICsgJ0NvbG9yJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKGFbMV0gKyAnQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhlYWRNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnSGVhZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdUb3JzbycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wZWx2aXNNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnUGVsdmlzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyQXJtTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ1VwcGVyQXJtJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmZvcmVBcm1Nb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnRm9yZUFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbChhWzFdICsgJ0hhbmQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudXBwZXJMZWdNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnVXBwZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQubG93ZXJMZWdNb2RlbCA9IGJzLmdldE1vZGVsKGFbMV0gKyAnTG93ZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoYVsxXSArICdUb2VzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN0eWxlID0gYVsxXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3NwYXphbGwgb3IgL3NwYXogbnVtYmVyIG9mIGxpc3QnKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ2Vycm9yJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL3pvbWJpZScsICcvem9tYmllYWxsJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIAlicy5zY3JlZW5NZXNzYWdlKCdNYWRlIEJ5IERlc2llcicsY29sb3I9KDEsMC4xOCwwLjQyKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbSA9PSAnL3pvbWJpZWFsbCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9yc28nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuY29sb3JNYXNrVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ3BpeGllQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2FnZW50Q29sb3InKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gYnMuZ2V0TW9kZWwoJ3pvZUhlYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUucGVsdmlzTW9kZWwgPSBicy5nZXRNb2RlbCgncGl4aWVQZWx2aXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUudXBwZXJBcm1Nb2RlbCA9IGJzLmdldE1vZGVsKCdmcm9zdHlVcHBlckFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5mb3JlQXJtTW9kZWwgPSBicy5nZXRNb2RlbCgnZnJvc3R5Rm9yZUFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNIYW5kJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnVwcGVyTGVnTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNVcHBlckxlZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5sb3dlckxlZ01vZGVsID0gYnMuZ2V0TW9kZWwoJ3BpeGllTG93ZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9lcycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oaWdobGlnaHQgPSAoMCwxLDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5jb2xvciA9ICgwLjYsMC42LDAuNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLnN0eWxlID0gJ3NwYXonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZXJyb3InCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FnZTogL3pvbWJpZWFsbCBvciAvem9tYmllIHBsYXllcl9jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gaW50KGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS50b3Jzb01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9yc28nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuY29sb3JNYXNrVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ3BpeGllQ29sb3JNYXNrJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2FnZW50Q29sb3InKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUuaGVhZE1vZGVsID0gYnMuZ2V0TW9kZWwoJ3pvZUhlYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUucGVsdmlzTW9kZWwgPSBicy5nZXRNb2RlbCgncGl4aWVQZWx2aXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUudXBwZXJBcm1Nb2RlbCA9IGJzLmdldE1vZGVsKCdmcm9zdHlVcHBlckFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5mb3JlQXJtTW9kZWwgPSBicy5nZXRNb2RlbCgnZnJvc3R5Rm9yZUFybScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5oYW5kTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNIYW5kJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLnVwcGVyTGVnTW9kZWwgPSBicy5nZXRNb2RlbCgnYm9uZXNVcHBlckxlZycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5sb3dlckxlZ01vZGVsID0gYnMuZ2V0TW9kZWwoJ3BpeGllTG93ZXJMZWcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW25dLmFjdG9yLm5vZGUudG9lc01vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbmVzVG9lcycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5oaWdobGlnaHQgPSAoMCwxLDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvciA9ICgwLjYsMC42LDAuNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLnN0eWxlID0gJ3NwYXonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzYWdlOiAvem9tYmllYWxsIG9yIC96b21iaWUgcGxheWVyX2NvZGUnKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBtIGluICgnL2ludicsICcvaW52YWxsJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvaW52YWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBpLmFjdG9yLm5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhlYWRNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRvcnNvTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wZWx2aXNNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyQXJtTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5mb3JlQXJtTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oYW5kTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC51cHBlckxlZ01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQubG93ZXJMZWdNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRvZXNNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN0eWxlID0gJ2N5Ym9yZycKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvaW52YWxsIG9yIC9pbnYgbnVtYmVyIG9mIGxpc3QnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBpbnQoYVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuaGVhZE1vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9yc29Nb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnBlbHZpc01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudXBwZXJBcm1Nb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmZvcmVBcm1Nb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmhhbmRNb2RlbCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnVwcGVyTGVnTW9kZWwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5sb3dlckxlZ01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9lc01vZGVsID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3R5bGUgPSAnY3lib3JnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2ludmFsbCBvciAvaW52IG51bWJlciBvZiBsaXN0JykKCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgogICAgICAgICAgICAgICAgZWxpZiBtID09ICcvYnVubnlOT3RhdmFpbGFiZWhlcmUnOgogICAgICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2J1bm55IGNvdW50IG93bmVyKG51bWJlciBvZiBsaXN0KScpCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0IEJ1ZGR5QnVubnkKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShpbnQoYVswXSkpOgogICAgICAgICAgICAgICAgICAgICAgICBwID0gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbaW50KGFbMV0pXQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYnVubmllcycgbm90IGluIHAuZ2FtZURhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmdhbWVEYXRhWydidW5uaWVzJ10gPSBCdWRkeUJ1bm55LkJ1bm55Qm90U2V0KHApCiAgICAgICAgICAgICAgICAgICAgICAgIHAuZ2FtZURhdGFbJ2J1bm5pZXMnXS5kb0J1bm55KCkKCiAgICAgICAgICAgICAgICBlbGlmIG0gaW4gKCcvdGV4JywgJy90ZXhhbGwnKToKICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvdGV4YWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmNvbG9yTWFza1RleHR1cmUgPSBicy5nZXRUZXh0dXJlKCdlZ2cxJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuY29sb3JUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgnZWdnMScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Vycm9yJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCiAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC90ZXhhbGwgb3IgL3RleCBudW1iZXIgb2YgbGlzdCcpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGludChhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbbl0uYWN0b3Iubm9kZS5jb2xvck1hc2tUZXh0dXJlID0gYnMuZ2V0VGV4dHVyZSgnZWdnMScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tuXS5hY3Rvci5ub2RlLmNvbG9yVGV4dHVyZSA9IGJzLmdldFRleHR1cmUoJ2VnZzEnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCgoJCWVsaWYgbGV2ZWw+MToKICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvdHRtZyc6IAogICAgICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdUaGFua3MgVG8gUGMgTW9kZGVyJyxjb2xvcj0oMSwxLDEpLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTogICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYnMuc2NyZWVuTWVzc2FnZSgoYVswXSksY29sb3IgPSAoMSwxLDEpKSAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNVdGlscy5ab29tVGV4dCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYVswXSksIG1heFdpZHRoPTgwMCwgbGlmZXNwYW49MjUwMCwgaml0dGVyPTIuMCwgcG9zaXRpb249KDAsIDE4MCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhc2g9RmFsc2UsIGNvbG9yPSgoMCtyYW5kb20ucmFuZG9tKCkqMC41KSwoMCtyYW5kb20ucmFuZG9tKCkqMC41KSwoMCtyYW5kb20ucmFuZG9tKCkqMC41KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWxDb2xvcj0oKDArcmFuZG9tLnJhbmRvbSgpKjQuNSksKDArcmFuZG9tLnJhbmRvbSgpKjQuNSksKDArcmFuZG9tLnJhbmRvbSgpKjQuNSkpKS5hdXRvUmV0YWluKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgICAgICAgICAgICAgIGlmIG0gPT0gJy90bWcnOiAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXTogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnVGhhbmtzIFRvIFBjIE1vZGRlcicsY29sb3I9KDEsMSwxKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTogICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYnMuc2NyZWVuTWVzc2FnZSgoYVswXSksY29sb3IgPSAoMSwxLDEpKSAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IChhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuWm9vbVRleHQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaywgbWF4V2lkdGg9ODAwLCBsaWZlc3Bhbj0yNTAwLCBqaXR0ZXI9Mi4wLCBwb3NpdGlvbj0oMCwgMTgwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFzaD1GYWxzZSwgY29sb3I9KDAuOTMgKiAxLjI1LCAwLjkgKiAxLjI1LCAxLjAgKiAxLjI1KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbENvbG9yPSgwLjE1LCAwLjA1LCAxLjAsIDAuMCkpLmF1dG9SZXRhaW4oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCQkJCiAgICAgICAgICAgICAgICAgICAgaWYgbSBpbiAoJy9mcmVlemUnLCAnL2ZyZWV6ZWFsbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvZnJlZXplYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhhbmRsZU1lc3NhZ2UoYnMuRnJlZXplTWVzc2FnZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2ZyZWV6ZWFsbCBvciAvZnJlZXplIG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZShicy5GcmVlemVNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvZnJlZXplYWxsIG9yIC9mcmVlemUgbnVtYmVyIG9mIGxpc3QnKQoKICAgICAgICAgICAgICAgICAgICBlbGlmIG0gaW4gKCcvdGhhdycsICcvdGhhd2FsbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtID09ICcvdGhhd2FsbCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBicy5nZXRTZXNzaW9uKCkucGxheWVyczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oYW5kbGVNZXNzYWdlKGJzLlRoYXdNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3RoYXdhbGwgb3IgbnVtYmVyIG9mIGxpc3QnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5oYW5kbGVNZXNzYWdlKGJzLlRoYXdNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvdGhhd2FsbCBvciAvdGhhdyBudW1iZXIgb2YgbGlzdCcpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9zbGVlcCcsICcvc2xlZXBhbGwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbSA9PSAnL3NsZWVwYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhhbmRsZU1lc3NhZ2UoJ2tub2Nrb3V0JywgNTAwMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvc2xlZXBhbGwgb3IgL3NsZWVwIG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZSgna25vY2tvdXQnLCA1MDAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL3NsZWVwYWxsIG9yIC9zbGVlcCBudW1iZXIgb2YgbGlzdCcpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9raWxsJywgJy9raWxsYWxsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG0gPT0gJy9raWxsYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5ub2RlLmhhbmRsZU1lc3NhZ2UoYnMuRGllTWVzc2FnZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGEgPT0gW106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC9raWxsYWxsIG9yIC9raWxsIG51bWJlciBvZiBsaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaGFuZGxlTWVzc2FnZShicy5EaWVNZXNzYWdlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAva2lsbGFsbCBvciAva2lsbCBudW1iZXIgb2YgbGlzdCcpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL2N1cnNlJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2N1cnNlIGFsbCBvciBudW1iZXIgb2YgbGlzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnYWxsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5hY3Rvci5jdXJzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2Vzc2lvbigpLnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5jdXJzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9zbSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLnNsb3dNb3Rpb24gPSBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5zbG93TW90aW9uID09IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKICAgICAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9lbmQnOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZW5kR2FtZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCgoKICAgICAgICAgICAgICAgICAgICBlbGlmIGxldmVsID4gMjoKCQkgICAgICAgICAgICBpZiBtID09ICcvcXVpdCc6CgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLnF1aXQoKQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2F1dG9hZG1pbicgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIHZhbCA9ICIxIgoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgdmFsID0gc3RyKGFbMF0pCgkJICAgICAgICAgICAgICAgIGxvdmUuYWRtaW4odmFsKQoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9hdXRvdmlwJyBhbmQgbGV2ZWwgPiAzOgoJCSAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgdmFsID0gIjIiCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB2YWwgPSBzdHIoYVswXSkKCQkgICAgICAgICAgICAgICAgbG92ZS52aXAodmFsKQoJCSAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9raWNrJzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2tpY2sgbmFtZSBvciBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsaWYgbGVuKGFbMF0pID4gMzoKCQkgICAgICAgICAgICAgICAgICAgIHNlbGYua2lja0J5TmljayhhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2Rpc2Nvbm5lY3RDbGllbnQoaW50KGFbMF0pKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2lja0J5TmljayhhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9hZG1pbicgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5hZG1pbkhhc2hlcwoJCSAgICAgICAgICAgICAgICBmb3IgY2xpZW50IGluIGJzSW50ZXJuYWwuX2dldEdhbWVSb3N0ZXIoKToKCQkgICAgICAgICAgICAgICAgICAgIGlmIGNsaWVudFsnY2xpZW50SUQnXSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNsX3N0ciA9IGNsaWVudFsnZGlzcGxheVN0cmluZyddCgoJCSAgICAgICAgICAgICAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgbmV3YWRtaW4gPSBpLmdldF9hY2NvdW50X2lkKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiBhWzFdID09ICdhZGQnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdhZG1pbiBub3QgaW4gdXBkYXRlZF9hZG1pbnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguYWRtaW5IYXNoZXMuYXBwZW5kKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5hZG1pbkhhc2hlcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvbWVtYmVyc2lkbG9nZ2VkLnR4dCcsIG1vZGU9J2ErJykgYXMgKGZpKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaS53cml0ZShjbF9zdHIgKyAnIHx8ICcgKyBuZXdhZG1pbiArICdcbicpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmkuY2xvc2UoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVsxXSA9PSAncmVtb3ZlJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3YWRtaW4gaW4gdXBkYXRlZF9hZG1pbnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguYWRtaW5IYXNoZXMucmVtb3ZlKG5ld2FkbWluKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC5hZG1pbkhhc2hlcwoKCQkgICAgICAgICAgICAgICAgaWYgbGVuKGEpID4gMjoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMl0gPT0gJ3Blcm1hbmVudCcgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScpIGFzIChmaWxlKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IFsgcm93IGZvciByb3cgaW4gZmlsZSBdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNbMF0gPSAnYWRtaW5IYXNoZXMgPSAnICsgc3RyKHVwZGF0ZWRfYWRtaW5zKSArICdcbicKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSkKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL3ZpcCcgYW5kIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICB1cGRhdGVkX2FkbWlucyA9IGdwaC52aXBIYXNoZXMKCQkgICAgICAgICAgICAgICAgZm9yIGNsaWVudCBpbiBic0ludGVybmFsLl9nZXRHYW1lUm9zdGVyKCk6CgkJICAgICAgICAgICAgICAgICAgICBpZiBjbGllbnRbJ2NsaWVudElEJ10gPT0gY2xJRDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBjbF9zdHIgPSBjbGllbnRbJ2Rpc3BsYXlTdHJpbmcnXQoKCQkgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CgkJICAgICAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIG5ld2FkbWluID0gaS5nZXRfYWNjb3VudF9pZCgpCgkJICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVsxXSA9PSAnYWRkJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3YWRtaW4gbm90IGluIHVwZGF0ZWRfYWRtaW5zOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLnZpcEhhc2hlcy5hcHBlbmQobmV3YWRtaW4pCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfYWRtaW5zID0gZ3BoLnZpcEhhc2hlcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvbWVtYmVyc2lkbG9nZ2VkLnR4dCcsIG1vZGU9J2ErJykgYXMgKGZpKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaS53cml0ZShjbF9zdHIgKyAnIHx8ICcgKyBuZXdhZG1pbiArICdcbicpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmkuY2xvc2UoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVsxXSA9PSAncmVtb3ZlJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3YWRtaW4gaW4gdXBkYXRlZF9hZG1pbnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGgudmlwSGFzaGVzLnJlbW92ZShuZXdhZG1pbikKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9hZG1pbnMgPSBncGgudmlwSGFzaGVzCgoJCSAgICAgICAgICAgICAgICBpZiBsZW4oYSkgPiAyOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgYVsyXSA9PSAncGVybWFuZW50JyBhbmQgbGV2ZWwgPiAyOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL2dldFBlcm1pc3Npb25zSGFzaGVzLnB5JykgYXMgKGZpbGUpOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1sxXSA9ICd2aXBIYXNoZXMgPSAnICsgc3RyKHVwZGF0ZWRfYWRtaW5zKSArICdcbicKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSkKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9yZW1vdmUnOgoJCSAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzaW5nOiAvcmVtb3ZlIGFsbCBvciBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnYWxsJzoKCQkgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzLmdldFNlc3Npb24oKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5yZW1vdmVGcm9tR2FtZSgpCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICBicy5nZXRTZXNzaW9uKCkucGxheWVyc1tpbnQoYVswXSldLnJlbW92ZUZyb21HYW1lKCkKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKCgkJICAgICAgICAgICAgZWxpZiBtIGluICgnL2h1ZycsICcvaHVnYWxsJyk6CgkJICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgIGlmIG0gPT0gJy9odWdhbGwnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbMF0uYWN0b3Iubm9kZS5ob2xkTm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzFdLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1sxXS5hY3Rvci5ub2RlLmhvbGROb2RlID0gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbMF0uYWN0b3Iubm9kZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbM10uYWN0b3Iubm9kZS5ob2xkTm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzJdLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbNF0uYWN0b3Iubm9kZS5ob2xkTm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzNdLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbNV0uYWN0b3Iubm9kZS5ob2xkTm9kZSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzWzZdLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1s2XS5hY3Rvci5ub2RlLmhvbGROb2RlID0gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbN10uYWN0b3Iubm9kZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2h1Z2FsbCBvciAvaHVnIG51bWJlciBvZiBsaXN0JykKCQkgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaG9sZE5vZGUgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkucGxheWVyc1tpbnQoYVsxXSldLmFjdG9yLm5vZGUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEgVXNhZ2U6IC9odWdhbGwgb3IgL2h1ZyBudW1iZXIgb2YgbGlzdCcpCgoJCSAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL3RpbnQnOgoJCSAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzaW5nOiAvdGludCBSIEcgQicpCgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnT1InKQoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzaW5nOiAvdGludCByIGJyaWdodCBzcGVlZCcpCgkJICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAncic6CgkJICAgICAgICAgICAgICAgICAgICBtID0gMS4zIGlmIGFbMV0gaXMgTm9uZSBlbHNlIGZsb2F0KGFbMV0pCgkJICAgICAgICAgICAgICAgICAgICBzID0gMTAwMCBpZiBhWzJdIGlzIE5vbmUgZWxzZSBmbG9hdChhWzJdKQoJCSAgICAgICAgICAgICAgICAgICAgYnNVdGlscy5hbmltYXRlQXJyYXkoYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJyksICd0aW50JywgMywgezA6ICgxICogbSwgMCwgMCksIHM6ICgwLCAxICogbSwgMCksIHMgKiAyOiAoMCwgMCwgMSAqIG0pLCBzICogMzogKDEgKiBtLCAwLCAwKX0sIFRydWUpCgkJICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiBhWzFdIGlzIG5vdCBOb25lOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS50aW50ID0gKAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQoYVswXSksIGZsb2F0KGFbMV0pLCBmbG9hdChhWzJdKSkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0Vycm9yIScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvcGF1c2UnOgoJCSAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5wYXVzZWQgPSBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5wYXVzZWQgPT0gRmFsc2UKCQkgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvY2FtZXJhTW9kZSc6CgkJICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgIGlmIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLmNhbWVyYU1vZGUgPT0gJ2ZvbGxvdyc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykuY2FtZXJhTW9kZSA9ICdyb3RhdGUnCgkJICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLmNhbWVyYU1vZGUgPSAnZm9sbG93JwoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvbG0nOgoJCSAgICAgICAgICAgICAgICBhcnIgPSBbXQoJCSAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSgxMDApOgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGFyci5hcHBlbmQoYnNJbnRlcm5hbC5fZ2V0Q2hhdE1lc3NhZ2VzKClbKC0xIC0gaSldKQoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgIGFyci5yZXZlcnNlKCkKCQkgICAgICAgICAgICAgICAgZm9yIGkgaW4gYXJyOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoaSkKCgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2dwJzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL2dwIG51bWJlciBvZiBsaXN0JykKCQkgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgIHMgPSBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdFNlc3Npb24oKQoJCSAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcy5wbGF5ZXJzW2ludChhWzBdKV0uZ2V0SW5wdXREZXZpY2UoKS5fZ2V0UGxheWVyUHJvZmlsZXMoKToKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKGkpCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvaWN5JzoKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5ub2RlID0gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbaW50KGFbMV0pXS5hY3Rvci5ub2RlCgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSBpbiAoJy9mbHknLCAnL2ZseWFsbCcpOgoJCSAgICAgICAgICAgICAgICBpZiBtID09ICcvZmx5YWxsJzoKCQkgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5mbHkgPSBUcnVlCgoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgIGVsaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISEgVXNhZ2U6IC9mbHlhbGwgb3IgL2ZseSBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5ub2RlLmZseSA9IGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5mbHkgPT0gRmFsc2UKCQkgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnRmFpbGVkISEhIFVzYWdlOiAvZmx5YWxsIG9yIC9mbHkgbnVtYmVyIG9mIGxpc3QnKQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9mbG9vclJlZmxlY3Rpb24nOgoJCSAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5mbG9vclJlZmxlY3Rpb24gPSBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS5mbG9vclJlZmxlY3Rpb24gPT0gRmFsc2UKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9hYyc6CgkJICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNpbmc6IC9hYyBSIEcgQicpCgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnT1InKQoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1VzaW5nOiAvYWMgciBicmlnaHQgc3BlZWQnKQoJCSAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJ3InOgoJCSAgICAgICAgICAgICAgICAgICAgbSA9IDEuMyBpZiBhWzFdIGlzIE5vbmUgZWxzZSBmbG9hdChhWzFdKQoJCSAgICAgICAgICAgICAgICAgICAgcyA9IDEwMDAgaWYgYVsyXSBpcyBOb25lIGVsc2UgZmxvYXQoYVsyXSkKCQkgICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuYW5pbWF0ZUFycmF5KGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLCAnYW1iaWVudENvbG9yJywgMywgezA6ICgxICogbSwgMCwgMCksIHM6ICgwLCAxICogbSwgMCksIHMgKiAyOiAoMCwgMCwgMSAqIG0pLCBzICogMzogKDEgKiBtLCAwLCAwKX0sIFRydWUpCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVsxXSBpcyBub3QgTm9uZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJykuYW1iaWVudENvbG9yID0gKAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQoYVswXSksIGZsb2F0KGFbMV0pLCBmbG9hdChhWzJdKSkKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRXJyb3IhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9pY2VPZmYnOgoJCSAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5nZXRNYXAoKS5ub2RlLm1hdGVyaWFscyA9IFsKCQkgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2Zvb3RpbmdNYXRlcmlhbCcpXQoJCSAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkuZ2V0TWFwKCkuaXNIb2NrZXkgPSBGYWxzZQoJCSAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkuZ2V0TWFwKCkuZmxvb3IubWF0ZXJpYWxzID0gWwoJCSAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2Zvb3RpbmdNYXRlcmlhbCcpXQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LmdldE1hcCgpLmlzSG9ja2V5ID0gRmFsc2UKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYWN0aXZpdHkucGxheWVyczoKCQkgICAgICAgICAgICAgICAgICAgICAgICBpLmFjdG9yLm5vZGUuaG9ja2V5ID0gRmFsc2UKCgkJICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL21heFBsYXllcnMnIGFuZCBsZXZlbCA+MzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2luZzogL21heFBsYXllcnMgY291bnQgb2YgcGxheWVycycpCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkuX21heFBsYXllcnMgPSBpbnQoYVswXSkKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9zZXRQdWJsaWNQYXJ0eU1heFNpemUoaW50KGFbMF0pKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdNYXhpbXVtIHBsYXllcnMgc2V0IHRvICcgKyBzdHIoaW50KGFbMF0pKSkKCQkgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdFcnJvciEnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgZWxpZiBtIGluICgnL2hlYWwnLCAnL2hlYWxhbGwnKToKCQkgICAgICAgICAgICAgICAgaWYgbSA9PSAnL2hlYWxhbGwnOgoJCSAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnMuZ2V0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5hY3Rvci5leGlzdHMoKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5oYW5kbGVNZXNzYWdlKGJzLlBvd2VydXBNZXNzYWdlKHBvd2VydXBUeXBlID0naGVhbHRoJykpCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoKCQkgICAgICAgICAgICAgICAgZWxpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ0ZhaWxlZCEhIFVzYWdlOiAvaGVhbGFsbCBvciAvaGVhbCBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0QWN0aXZpdHkoKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5oYW5kbGVNZXNzYWdlKGJzLlBvd2VydXBNZXNzYWdlKHBvd2VydXBUeXBlID0naGVhbHRoJykpCgkJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdGYWlsZWQhISBVc2FnZTogL2hlYWxhbGwgb3IgL2hlYWwgbnVtYmVyIG9mIGxpc3QnKQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9nbSc6CgkJICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGFjdGl2aXR5LnBsYXllcnMpKToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWN0aXZpdHkucGxheWVyc1tpXS5nZXRJbnB1dERldmljZSgpLmdldENsaWVudElEKCkgPT0gY2xpZW50SUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5wbGF5ZXJzW2ldLmFjdG9yLm5vZGUuaG9ja2V5ID0gYWN0aXZpdHkucGxheWVyc1tpXS5hY3Rvci5ub2RlLmhvY2tleSA9PSBGYWxzZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkucGxheWVyc1tpXS5hY3Rvci5ub2RlLmludmluY2libGUgPSBhY3Rpdml0eS5wbGF5ZXJzW2ldLmFjdG9yLm5vZGUuaW52aW5jaWJsZSA9PSBGYWxzZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkucGxheWVyc1tpXS5hY3Rvci5fcHVuY2hQb3dlclNjYWxlID0gNSBpZiBhY3Rpdml0eS5wbGF5ZXJzW2ldLmFjdG9yLl9wdW5jaFBvd2VyU2NhbGUgPT0gMS4yIGVsc2UgMS4yCgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5ob2NrZXkgPSBhY3Rpdml0eS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5ob2NrZXkgPT0gRmFsc2UKCQkgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5pbnZpbmNpYmxlID0gYWN0aXZpdHkucGxheWVyc1tpbnQoYVswXSldLmFjdG9yLm5vZGUuaW52aW5jaWJsZSA9PSBGYWxzZQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnBsYXllcnNbaW50KGFbMF0pXS5hY3Rvci5fcHVuY2hQb3dlclNjYWxlID0gNSBpZiBhY3Rpdml0eS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3IuX3B1bmNoUG93ZXJTY2FsZSA9PSAxLjIgZWxzZSAxLjIKCQkgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1BMQVlFUiBOT1QgRk9VTkQnKQoKCQkgICAgICAgICAgICBlbGlmIG0gPT0gJy9yZWZsZWN0aW9ucyc6CgkJICAgICAgICAgICAgICAgIGlmIGxlbihhKSA8IDI6CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNhZ2U6IC9yZWZsZWN0aW9ucyB0eXBlKDEvMCkgc2NhbGUnKQoJCSAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgcnMgPSBbCgkJICAgICAgICAgICAgICAgICAgICAgaW50KGFbMV0pXQoJCSAgICAgICAgICAgICAgICAgICAgdHlwZWUgPSAnc29mdCcgaWYgaW50KGFbMF0pID09IDAgZWxzZSAncG93ZXJ1cCcKCQkgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZS5yZWZsZWN0aW9uID0gdHlwZWUKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkubm9kZS5yZWZsZWN0aW9uU2NhbGUgPSBycwoJCSAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdub2RlJwoJCSAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuYmcucmVmbGVjdGlvbiA9IHR5cGVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5iZy5yZWZsZWN0aW9uU2NhbGUgPSBycwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYmcnCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmZsb29yLnJlZmxlY3Rpb24gPSB0eXBlZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLmZsb29yLnJlZmxlY3Rpb25TY2FsZSA9IHJzCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZmxvb3InCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuY2VudGVyLnJlZmxlY3Rpb24gPSB0eXBlZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuY2VudGVyLnJlZmxlY3Rpb25TY2FsZSA9IHJzCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjZW50ZXInCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvc2hhdHRlcic6CgkJICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNpbmc6IC9zaGF0dGVyIGFsbCBvciBudW1iZXIgb2YgbGlzdCcpCgkJICAgICAgICAgICAgICAgIGVsaWYgYVswXSA9PSAnYWxsJzoKCQkgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGkuYWN0b3Iubm9kZS5zaGF0dGVyZWQgPSBpbnQoYVsxXSkKCgkJICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzW2ludChhWzBdKV0uYWN0b3Iubm9kZS5zaGF0dGVyZWQgPSBpbnQoYVsxXSkKCQkgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgIGVsaWYgbSA9PSAnL2NtJzoKCQkgICAgICAgICAgICAgICAgaWYgYSA9PSBbXToKCQkgICAgICAgICAgICAgICAgICAgIHRpbWUgPSA4MDAwCgkJICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICB0aW1lID0gaW50KGFbMF0pCgkJICAgICAgICAgICAgICAgICAgICBvcCA9IDAuMDgKCQkgICAgICAgICAgICAgICAgICAgIHN0ZCA9IGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLnZpZ25ldHRlT3V0ZXIKCQkgICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuYW5pbWF0ZUFycmF5KGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLCAndmlnbmV0dGVPdXRlcicsIDMsIHswOiBicy5nZXRTaGFyZWRPYmplY3QoJ2dsb2JhbHMnKS52aWduZXR0ZU91dGVyLCAxNzAwMDogKDAsIDEsIDApfSkKCQkgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLm5vZGUub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuYmcub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5iZy5ub2RlLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlMS5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlMi5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlMy5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuc3RlcHMub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuZmxvb3Iub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5jZW50ZXIub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgZGVmIG9mZigpOgoJCSAgICAgICAgICAgICAgICAgICAgb3AgPSAxCgkJICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLm5vZGUub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5iZy5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9nZXRGb3JlZ3JvdW5kSG9zdEFjdGl2aXR5KCkuZ2V0TWFwKCkuYmcubm9kZS5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlMS5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLm5vZGUyLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5ub2RlMy5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLmdldE1hcCgpLnN0ZXBzLm9wYWNpdHkgPSBvcAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5mbG9vci5vcGFjaXR5ID0gb3AKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5nZXRNYXAoKS5jZW50ZXIub3BhY2l0eSA9IG9wCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgoJCSAgICAgICAgICAgICAgICAgICAgYnNVdGlscy5hbmltYXRlQXJyYXkoYnMuZ2V0U2hhcmVkT2JqZWN0KCdnbG9iYWxzJyksICd2aWduZXR0ZU91dGVyJywgMywgezA6IGJzLmdldFNoYXJlZE9iamVjdCgnZ2xvYmFscycpLnZpZ25ldHRlT3V0ZXIsIDEwMDogc3RkfSkKCgkJICAgICAgICAgICAgICAgIGJzLmdhbWVUaW1lcih0aW1lLCBicy5DYWxsKG9mZikpCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvaGVscCc6CgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJIZXJlIGlzIFlvdXIgSGVscCIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1Db21tYW5kcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIi9pbmZvIC9lbSAvc2hvcCAvc2NvcmV0b2Nhc2ggL2Nhc2h0b3Njb3JlIC9kb25hdGUiKQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiQXJlIFlvdSBhIEFkbWluIHZpcCBvciBPd25lcj8sIEFuZCBZb3UgYWxzbyBXYW50IHRvIEdldCBIZWxwZWQ/IikKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIlRyeSAvYWhlbHAgZm9yIGFkbWluIC92aGVscCBmb3IgdmlwICYgL29oZWxwIGZvciBvd25lciIpCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvYWhlbHAnIGFuZCBsZXZlbCA+IDI6CgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJIZXJlIGlzIFlvdXIgSGVscCIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1Db21tYW5kcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIi9raWNrIC9xdWl0IC9ncCAvZ20gL2VuZCAvcGF1c2UiKQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiWW91IGNhbiB1c2UgYWxsIFZpcCBDb21tYW5kcyIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHUiXHVlMDBjU2NyaXB0IEJ5IERlc2lyZVx1ZTAwYyIpCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvdmhlbHAnIGFuZCBsZXZlbCA+IDE6CgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJIZXJlIGlzIFlvdXIgSGVscCIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1Db21tYW5kcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIi9raWxsYWxsIC9lbmQgL252IC90aW50IC9yZWZsZWN0aW9uIC9mcmVlemUgYWxsIC90aGF3YWxsIC9pbnZhbGwgL3NtZyIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIvdHRtZyAvdG1nIC9hYyAvcGxheXNvdW5kIC9ib3hhbGwgL3pvbWJpZSAvc3BheiAvYnVubnkgL3RleCIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCIvc2xlZXAgL2N1cnNlIC9zbSAvaHVnIC9jYW1lcmFNb2RlIC9pY3kgL2ZseSAvZmxvb3JSZWZsZWN0aW9uIC9pY2VPZmYiKQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiL2hlYWwgL3NoYXR0ZXIgL2NtIC9pZCIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKHUiXHVlMDBjU2NyaXB0IEJ5IERlc2lyZVx1ZTAwYyIpCgkJICAgICAgICAgICAgZWxpZiBtID09ICcvb2hlbHAnIGFuZCBsZXZlbCA+IDM6CgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJIZXJlIGlzIFlvdXIgSGVscCIpCgkJICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1Db21tYW5kcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIi9zZXR0aW5ncyAvcHNldHRpbmdzIC9ic2V0dGluZ3MgL2F1dG9hZG1pbiAvYXV0b3ZpcCAvdGVhbW5hbWUiKQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiL3BhcnR5bmFtZSAvYmFuIC90ZXh0IC93aG9pcyAvYWRtaW4gL3ZpcCAvY3VzdG9tIC9jdXN0b210YWciKQoJCSAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiL3B1YmxpYyAvY2xlYXIgL21heFBsYXllcnMgIikKCQkgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UodSJcdWUwMGNTY3JpcHQgQnkgRGVzaXJlXHVlMDBjIikKCQkKCQkgICAgICAgICAgICBlbGlmIGxldmVsID4gMzoKCQkgICAgICAgICAgICAgICAgaWYgbSA9PSAnL3BhcnR5bmFtZSc6CgkJICAgICAgICAgICAgICAgICAgICBpZiBUcnVlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIGEgPT0gW106CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdVc2FnZTogL3BhcnR5bmFtZSBOYW1lIG9mIHBhcnR5JykKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3ZhbHVlIG9mIGFbMF0gPSAnICsgYVswXQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gYVswXS5yZXBsYWNlKCdfJywgJyAnKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9zZXRQdWJsaWNQYXJ0eU5hbWUobmFtZSkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCdQYXJ0eSBuYW1lIGNoYW5nZWQgdG8gIicgKyBuYW1lICsgJyInKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLnNjcmVlbk1lc3NhZ2UoJ0ZhaWxlZCBUbyBDaGFuZ2UnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9zZXR0aW5ncyc6CgkJICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJVc2FnZSAvc2V0dGluZ3MgKG51bWJlciBpbiBsaXN0KSAoMCwxKSIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIkxpc3QgT2YgU2V0dGluZ3M6IikKCQkgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgiMS4gYW5pbWF0ZSIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjIuTmlnaHQgTW9kZSIpCgkJICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIjMuRW5hYmxlIE9yIERpc2FibGUgU3RhdHMiKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCI0LkNvaW4gU3lzdGVtIikKCQkgICAgICAgICAgICAgICAgICAgIHQgPSBpbnQoYVsxXSkKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjEiOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGxvdmUuYVQodCkKCQkgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjIiOgoJCSAgICAgICAgICAgICAgICAgICAgCWxvdmUubk0odCkKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjMiOgoJCSAgICAgICAgICAgICAgICAgICAgCWxvdmUuc1ModCkKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgIGlmIGFbMF0gPT0gIjQiOgoJCSAgICAgICAgICAgICAgICAgICAgCWxvdmUuY1ModCkKCQkgICAgICAgICAgICAgICAgICAgIAljb21tYW5kU3VjY2VzcyA9IFRydWUKCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9wdWJsaWMnOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgVHJ1ZToKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiBhID09IFtdOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNhZ2U6IC9wdWJsaWMgMCBvciAxJykKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFbMF0gPT0gJzAnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9zZXRQdWJsaWNQYXJ0eUVuYWJsZWQoRmFsc2UpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnUGFydHkgaXMgUHJpdmF0ZScpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuc2NyZWVuTWVzc2FnZSgnRmFpbGVkIFRvIENoYW5nZScsY29sb3I9KDEsMCwwKSwgY2xpZW50cz1bY2xpZW50SURdLCB0cmFuc2llbnQ9VHJ1ZSkKCgkJICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhWzBdID09ICcxJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fc2V0UHVibGljUGFydHlFbmFibGVkKFRydWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnUGFydHkgaXMgUHVibGljJykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdGYWlsZWQgVG8gQ2hhbmdlJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQoKCQkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnVXNhZ2U6IC9wdWJsaWMgMCBvciAxJykKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvaWQnOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgVHJ1ZToKCQkgICAgICAgICAgICAgICAgICAgICAgICBjbElEID0gaW50KGFbMF0pCgkJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZShpLmdldF9hY2NvdW50X2lkKCkpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9jdXN0b210YWcnOgoJCSAgICAgICAgICAgICAgICAgICAgaWYgVHJ1ZToKCQkgICAgICAgICAgICAgICAgICAgICAgICBjbElEID0gaW50KGFbMF0pCgkJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdhZG1pbiA9IGkuZ2V0X2FjY291bnRfaWQoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVsxXSA9PSAnYWRkJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguY3VzdG9tdGFnSGFzaGVzLmFwcGVuZChuZXdhZG1pbikKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYVsxXSA9PSAncmVtb3ZlJzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdhZG1pbiBpbiBncGguZHJhZ29uSGFzaGVzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguY3VzdG9tdGFnSGFzaGVzLnJlbW92ZShuZXdhZG1pbikKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy9jbGVhcic6CgkJICAgICAgICAgICAgICAgICAgICBpZiBUcnVlOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b21saXN0ID0gW10KCQkgICAgICAgICAgICAgICAgICAgICAgICBncGguY3VzdG9tdGFnSGFzaGVzID0gW10KCQkgICAgICAgICAgICAgICAgICAgICAgICBncGguZHJhZ29uSGFzaGVzID0gW10KCQkgICAgICAgICAgICAgICAgICAgICAgICBncGguYWRtaW5IYXNoZXMgPSBbXQoKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvYmFuJzoKCQkgICAgICAgICAgICAgICAgICAgIGlmIGEgIT0gW106CgkJICAgICAgICAgICAgICAgICAgICAgICAgYmFubmVkSWQgPSBOb25lCgkJCQkJYWlkID0gTm9uZQoJCSAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCQkJCSAgICBmb3IgaSBpbiBic0ludGVybmFsLl9nZXRHYW1lUm9zdGVyKCk6CgkJCQkJCWlmIGlbJ2NsaWVudElEJ10gPT0gY2xJRDoKCQkJCQkJICAgIGFpZCA9IGlbJ2Rpc3BsYXlTdHJpbmcnXQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAJICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCWlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCSAgICBiYW5uZWRJRCA9IGkuZ2V0X2FjY291bnRfaWQoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAkgICAgbmFtZSA9IGkuZ2V0TmFtZSgpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhaWQgaXMgbm90IE5vbmU6CgkJCQkJCWdwaC5iYW5saXN0W2Jhbm5lZElEXSA9IGFpZAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknKSBhcyAoZmlsZSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IFsgcm93IGZvciByb3cgaW4gZmlsZSBdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1syXSA9ICdiYW5saXN0ID0gJyArIHN0cihncGguYmFubGlzdCkgKyAnXG4nCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZSgnYmFubmVkICcgKyBuYW1lKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fZGlzY29ubmVjdENsaWVudChjbElEKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ3BsYXllciBub3QgZm91bmQnKQoKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvY3VzdG9tJzoKCQkgICAgICAgICAgICAgICAgICAgIHRyeToKCQkgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzID0gbGVuKGEpCgkJICAgICAgICAgICAgICAgICAgICAgICAgY2xJRCA9IGludChhWzBdKQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKS5wbGF5ZXJzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmdldElucHV0RGV2aWNlKCkuZ2V0Q2xpZW50SUQoKSA9PSBjbElEOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXIgPSBpLmdldF9hY2NvdW50X2lkKCkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFbMV0gPT0gJ2FkZCc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY3VzdG9tZXIgaW4gZ3BoLmN1c3RvbWxpc3Q6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b21saXN0LnBvcChjdXN0b21lcikKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGF0dHJpYnV0ZXMgPiAyOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnID0gYVsyXQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ1xcJyBpbiB0YWc6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnID0gdGFnLnJlcGxhY2UoJ1xcZCcsICgnXFx1ZTA0OCcpLmRlY29kZSgndW5pY29kZS1lc2NhcGUnKSkgCSNEcmFnb24KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWcgPSB0YWcucmVwbGFjZSgnXFxjJywgKCdcXHVlMDQzJykuZGVjb2RlKCd1bmljb2RlLWVzY2FwZScpKQkjQ3Jvd24JCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnID0gdGFnLnJlcGxhY2UoJ1xcaCcsICgnXFx1ZTA0OScpLmRlY29kZSgndW5pY29kZS1lc2NhcGUnKSkJI0hlbG1ldAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZyA9IHRhZy5yZXBsYWNlKCdcXHMnLCAoJ1xcdWUwNDYnKS5kZWNvZGUoJ3VuaWNvZGUtZXNjYXBlJykpCSNza3VsbAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZyA9IHRhZy5yZXBsYWNlKCdcXG4nLCAoJ1xcdWUwNGInKS5kZWNvZGUoJ3VuaWNvZGUtZXNjYXBlJykpCSNuaW5qYSBzdGFyCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnID0gdGFnLnJlcGxhY2UoJ1xcZicsICgnXFx1ZTA0ZicpLmRlY29kZSgndW5pY29kZS1lc2NhcGUnKSkJI2ZpcmViYWxsCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncGguY3VzdG9tbGlzdFtjdXN0b21lcl0gPSB0YWcKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGF0dHJpYnV0ZXMgPiAzOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFbM10gPT0gJ3Blcm1hbmVudCcgYW5kIGxldmVsID4gNToKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknKSBhcyAoZmlsZSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNbNV0gPSAnY3VzdG9tbGlzdCA9ICcgKyBzdHIoZ3BoLmN1c3RvbWxpc3QpICsgJ1xuJwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9nZXRQZXJtaXNzaW9uc0hhc2hlcy5weScsICd3JykKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShpKQoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2luc2lkZSBleGNlcHRpb24gYnV0IGFkZGluZyBpbnRvIGN1c3RvbUhhc2hlcycKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1c3RvbXRhZ0hhc2hlcy5hcHBlbmQoY3VzdG9tZXIpCgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTdWNjZXNzID0gVHJ1ZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhWzFdID09ICdyZW1vdmUnOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN1c3RvbWVyIGluIGdwaC5jdXN0b210YWdIYXNoZXM6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwaC5jdXN0b210YWdIYXNoZXMucmVtb3ZlKGN1c3RvbWVyKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXN0b21lciBpbiBncGguY3VzdG9tbGlzdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BoLmN1c3RvbWxpc3QucG9wKGN1c3RvbWVyKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kU3VjY2VzcyA9IFRydWUKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhdHRyaWJ1dGVzID4gMjoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYVsyXSA9PSAncGVybWFuZW50JzoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihicy5nZXRFbnZpcm9ubWVudCgpWydzeXN0ZW1TY3JpcHRzRGlyZWN0b3J5J10gKyAnL2dldFBlcm1pc3Npb25zSGFzaGVzLnB5JykgYXMgKGZpbGUpOgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBbIHJvdyBmb3Igcm93IGluIGZpbGUgXQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNbNV0gPSAnY3VzdG9tbGlzdCA9ICcgKyBzdHIoZ3BoLmN1c3RvbWxpc3QpICsgJ1xuJwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvZ2V0UGVybWlzc2lvbnNIYXNoZXMucHknLCAndycpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShpKQoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmNsb3NlKCkKCgkJICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCQkgICAgICAgICAgICAgICAgZWxpZiBtID09ICcvd2hvaXMnOgoJCQkJCXRyeToKCQkJCQkJY2xJRCA9IGludChhWzBdKQoJCQkJCQlJRCA9ICcnCgkJCQkgICAgICAgICAgICAgICAgZm9yIGkgaW4gYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RBY3Rpdml0eSgpLnBsYXllcnM6CgkJCQkgICAgICAgICAgICAgICAgICAgIGlmIGkuZ2V0SW5wdXREZXZpY2UoKS5nZXRDbGllbnRJRCgpID09IGNsSUQ6CgkJCQkgICAgICAgICAgICAgICAgICAgICAgICBJRCA9IGkuZ2V0X2FjY291bnRfaWQoKQoJCQkJCQkJbmFtZSA9IGkuZ2V0TmFtZShUcnVlLFRydWUpCgkJCQkJCWlmIElEIGlzIG5vdCAnJzoKCQkJCQkJICAgIHdpdGggb3BlbignbG9nUGxheWVycy5qc29uJywncicpIGFzIGY6CgkJCQkJCQlhbGxQbGF5ZXJzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkKCQkJCQkJCWFsbElEID0gYWxsUGxheWVyc1tJRF0KCQkJCQkJCXN0cmluZyA9ICdMb2dpbiBJRCBvZiAlcyBpczonICVuYW1lCgkJCQkJCQlmb3IgaSBpbiBhbGxJRDoKCQkJCQkJCQkjYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoaSkKCQkJCQkJCQlzdHJpbmcgKz0gJ1xuJyArIGkKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgIAkjY29tbWFuZFN1Y2Nlc3MgPSBUcnVlCgkJCQkJCQlicy5zY3JlZW5NZXNzYWdlKHN0cmluZywgdHJhbnNpZW50PVRydWUsIGNvbG9yPSgxLCAxLCAxKSkKCQkJCQlleGNlcHQ6CgkJCQkJCXByaW50ICd3aG8gaXMgZXhjZXB0aW9uJwoJCQkJCQkJCgkJICAgICAgICAgICAgICAgIGVsaWYgbSA9PSAnL3RleHQnOgoJCQkJCWZyb20gQnNUZXh0T25NYXAgaW1wb3J0IHRleHRzCgkJCQkJaWYgYSA9PSBbXToKCQkJCQkJYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoIlVzYWdlOiAvdGV4dCBzaG93YWxsIG9yIC90ZXh0IGFkZCBbdGV4dF0gb3IgL3RleHQgZGVsIFt0ZXh0bnVtYmVyXSIpCgkJCQkJZWxpZiBhWzBdID09ICdhZGQnIGFuZCBsZW4oYSk+MToKCQkJCQkJI2dldCB3aG9sZSBzZW50ZW5jZSBmcm9tIGFyZ3VtZW50IGxpc3QKCQkJCQkJbmV3VGV4dCA9IHUnJwoJCQkJCQlmb3IgaSBpbiByYW5nZSgxLGxlbihhKSk6CgkJCQkJCQluZXdUZXh0ICs9IGFbaV0gKyAnICcKCQkJCQkJI3ByaW50IG5ld1RleHQKCQkJCQkJdGV4dHMuYXBwZW5kKG5ld1RleHQpCgoJCQkJCQkjd3JpdGUgdG8gZmlsZQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvQnNUZXh0T25NYXAucHknKSBhcyAoZmlsZSk6CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IFsgcm93IGZvciByb3cgaW4gZmlsZSBdCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1swXSA9ICd0ZXh0cyA9ICcgKyBzdHIodGV4dHMpICsgJ1xuJwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBvcGVuKGJzLmdldEVudmlyb25tZW50KClbJ3N5c3RlbVNjcmlwdHNEaXJlY3RvcnknXSArICcvQnNUZXh0T25NYXAucHknLCAndycpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gczoKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShpKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xvc2UoKQoJCQkJCQkgICAgY29tbWFuZFN1Y2Nlc3M9VHJ1ZQoJCQkJCWVsaWYgYVswXSA9PSAnc2hvd2FsbCc6CgkJCQkJCWZvciBpIGluIHJhbmdlKGxlbih0ZXh0cykpOgoJCQkJCQkJI3ByaW50IHRleHRzKGkpCgkJCQkJCQlic0ludGVybmFsLl9jaGF0TWVzc2FnZShzdHIoaSkgKyAnLiAnICsgdGV4dHNbaV0pCgkJCQkJCWNvbW1hbmRTdWNjZXNzPVRydWUKCQkJCQllbGlmIGFbMF0gPT0gJ2RlbCcgYW5kIGxlbihhKT4xOgoJCQkJCSAgICB0cnk6CgkJCQkJCWlmIGxlbih0ZXh0cykgPiAxOgoJCQkJCQkJdGV4dHMucG9wKGludChhWzFdKSkKCQkJCQkJCSN3cml0ZSB0byBmaWxlCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9Cc1RleHRPbk1hcC5weScpIGFzIChmaWxlKToKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gWyByb3cgZm9yIHJvdyBpbiBmaWxlIF0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWzBdID0gJ3RleHRzID0gJyArIHN0cih0ZXh0cykgKyAnXG4nCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG9wZW4oYnMuZ2V0RW52aXJvbm1lbnQoKVsnc3lzdGVtU2NyaXB0c0RpcmVjdG9yeSddICsgJy9Cc1RleHRPbk1hcC5weScsICd3JykKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzOgoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkpCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbG9zZSgpCgkJCQkJCQkgICAgY29tbWFuZFN1Y2Nlc3M9VHJ1ZQoJCQkJCQllbHNlOgoJCQkJCQkJYnMuc2NyZWVuTWVzc2FnZSgnQXQgbGVhc3Qgb25lIHRleHQgdG8gc2hvdWxkIGJlIHByZXNlbnQnLGNvbG9yPSgxLDAsMCksIGNsaWVudHM9W2NsaWVudElEXSwgdHJhbnNpZW50PVRydWUpCgkJCQkJICAgIGV4Y2VwdDoKCQkJCQkJcGFzcwoJCQkJCWVsc2U6CgkJCQkJCWJzSW50ZXJuYWwuX2NoYXRNZXNzYWdlKCJVc2FnZTogL3RleHQgc2hvd2FsbCBvciAvdGV4dCBhZGQgW3RleHRdIG9yIC90ZXh0IGRlbCBbdGV4dG51bWJlcl0iKQoJCSAgICAgICAgICAgICAgICBlbGlmIG0gPT0gJy93aG9pbnF1ZXVlJzoKCQkJCSAgICAgICAgZGVmIF9vblF1ZXVlUXVlcnlSZXN1bHQocmVzdWx0KToKCQkJCQkgICAgI3ByaW50IHJlc3VsdCwgJyBpcyByZXN1bHQnCgkJCQkJICAgIGluUXVldWUgPSByZXN1bHRbJ2UnXQoJCQkJCSAgICAjcHJpbnQgaW5RdWV1ZSwgJyBpcyBpblF1ZXVlJwoJCQkJCSAgICBzdHJpbmcgPSAnTm8gb25lICcKCQkJCQkgICAgaWYgaW5RdWV1ZSAhPSBbXToKCQkJCQkJc3RyaW5nID0gJycKCQkJCQkJZm9yIHF1ZXVlIGluIGluUXVldWU6CgkJCQkJCQkjcHJpbnQgcXVldWVbM10KCQkJCQkJCXN0cmluZyArPSBxdWV1ZVszXSArICcgJwoJCQkJCSAgICBic0ludGVybmFsLl9jaGF0TWVzc2FnZShzdHJpbmcgKyAnaXMgaW4gdGhlIHF1ZXVlJykKCQkJCQkJCQoJCQkJCWJzSW50ZXJuYWwuX2FkZFRyYW5zYWN0aW9uKAoJCQkJCQl7J3R5cGUnOiAnUEFSVFlfUVVFVUVfUVVFUlknLCAncSc6ICJwX1MtbDE1MGE3YTFkLTBmMTItNDNkZS1hM2JmLTQ2N2E3YTViY2Q3Ml8xMDI5Mjk1XzEzLjIzMy4xMTYuMzJfNDMyMTAifSwKCQkJCQkJY2FsbGJhY2s9YnMuQ2FsbChfb25RdWV1ZVF1ZXJ5UmVzdWx0KSkKCQkJCQlic0ludGVybmFsLl9ydW5UcmFuc2FjdGlvbnMoKQkJCQkJCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBicy5zY3JlZW5NZXNzYWdlKCdGYWlsZWQhJyxjb2xvcj0oMSwwLDApLCBjbGllbnRzPVtjbGllbnRJRF0sIHRyYW5zaWVudD1UcnVlKQogICAgICAgIHJldHVybgoKCmMgPSBjaGF0T3B0aW9ucygpCgoKZGVmIGNtZChtc2csIGNsaWVudElEKToKICAgIGMub3B0KGNsaWVudElELCBtc2cpCiAgICBpZiBjb21tYW5kU3VjY2VzczoKICAgICAgICBpZiBjb21tYW5kQnlDb2luOgogICAgICAgICAgICBjb2luU3lzdGVtLmFkZENvaW5zKHVzZXIsIGNvc3RPZkNvbW1hbmQgKiAtMSkKICAgICAgICAgICAgYnNJbnRlcm5hbC5fY2hhdE1lc3NhZ2UoJ1N1Y2Nlc3MhIFRoYXQgY29zdCB5b3UgJyArIGJzLmdldFNwZWNpYWxDaGFyKCd0aWNrZXQnKSArIHN0cihjb3N0T2ZDb21tYW5kKSkKICAgICAgICBlbHNlOgoJICB0cnk6CgkJd2l0aCBicy5Db250ZXh0KGJzSW50ZXJuYWwuX2dldEZvcmVncm91bmRIb3N0QWN0aXZpdHkoKSk6CgkJCWJzLnNjcmVlbk1lc3NhZ2UocmVwbHksIGNvbG9yPSgwLjEsMSwwLjEpKQogICAgICAgICAgICAJCSNic0ludGVybmFsLl9jaGF0TWVzc2FnZShyZXBseSkKCSAgZXhjZXB0OgoJCXBhc3MKICAgIHJldHVybgo="))